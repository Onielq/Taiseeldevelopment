<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brilliant Tower | Taiseel Development</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <style>
        :root { --navy:#052f4a; --teal:#6ed6e7; --ink:#1f2a37; --muted:#64748b; --surface:#f3f4f6; --line:#d9dde3; --white:#fff; }
        *{box-sizing:border-box;margin:0;padding:0;}
        body{font-family:'Montserrat',sans-serif;color:var(--ink);background:var(--surface);line-height:1.42;font-size:13px;}
        a{color:inherit;}
        .site-header{position:sticky;top:0;z-index:100;background:linear-gradient(180deg,rgba(5,47,74,.96),rgba(5,47,74,.88));color:#fff;border-bottom:1px solid rgba(255,255,255,.15);}
        .header-inner{width:min(1200px,94%);margin:0 auto;display:flex;justify-content:space-between;align-items:center;min-height:58px;gap:24px;}
        .logo{text-decoration:none;font-weight:800;letter-spacing:1px;font-size:1.08rem;}
        .menu{display:flex;gap:26px;font-size:.85rem;font-weight:500;opacity:.95;}
        .menu a{text-decoration:none;}
        .hero{min-height:68vh;background:linear-gradient(rgba(7,32,49,.58),rgba(7,32,49,.58)),url('brilliant tower.jpg') center/cover no-repeat;color:#fff;display:flex;align-items:flex-end;padding:30px 0 28px;}
        .intro-section{position:relative;padding-top:58px;}
        .project-badge{position:absolute;top:-109px;left:8%;width:160px;height:110px;background:#f4f5f7;border:1px solid #d3d8de;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;z-index:3;}
        .project-badge .badge-mark{width:45px;height:34px;border:1px solid #8a97a6;border-radius:999px;display:grid;place-items:center;font-size:.8rem;color:#475569;margin-bottom:4px;}
        .project-badge .badge-name{font-size:.74rem;letter-spacing:1.2px;color:#334155;text-transform:uppercase;font-weight:600;line-height:1.35;}
        .project-title{font-family:'Playfair Display',serif;font-size:x-large;font-weight:500;color:#1e293b;margin-left:30px;margin-bottom:20px;letter-spacing:.2px;}
        .container{width:min(1200px,94%);margin:0 auto;}
        .hero-card{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.2);padding:10px;max-width:320px;min-height:72px;}
        .action-box{margin-top:16px;display:flex;flex-wrap:wrap;gap:10px;margin-left:30px;}
        .intro-btn{display:inline-flex;align-items:center;justify-content:center;min-height:40px;padding:9px 14px;border:1px solid #334a5c;color:#23384a;background:transparent;text-decoration:none;text-transform:uppercase;letter-spacing:.45px;font-size:.72rem;font-weight:700;}
        .intro-btn.primary{background:#0d3f60;color:#fff;border-color:#0d3f60;}
        .section{padding:30px 0;}
        .split{display:grid;grid-template-columns:1.1fr .9fr;gap:18px;align-items:stretch;}
        .card{background:transparent;border:0;padding:6px;height:100%;}
        .intro-offset-down{transform:translateY(10%);}
        h2{font-size:clamp(.98rem,2.4vw,1.25rem);font-weight:600;margin-left:30px;margin-bottom:4px;}
        .lead{color:#334155;font-size:.81rem;margin-left:30px;margin-bottom:4px;}
        .amenities-grid{display:grid;grid-template-columns:repeat(3,minmax(25px,1fr));row-gap:15px;column-gap:15px;margin-top:25px;margin-bottom:5px;}
        .amenity{border:1px solid #7f8f9d;aspect-ratio:1/.7;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:12px;font-size:.64rem;background:#f4f6f8;color:#253949;margin-top:5%;}
        .amenity-icon{width:30px;height:30px;object-fit:contain;margin-bottom:4px;opacity:.95;}
        .amenity-pager{display:flex;justify-content:center;gap:8px;margin-top:7px;}
        .amenity-pager .bullet{width:6px;height:6px;border-radius:999px;border:0;padding:0;background:#d2dae2;cursor:pointer;}
        .amenity-pager .bullet.active{background:#0f3a55;}
        #visual-collection{padding:0;background:#fff;}
        .visual-collection-header{width:min(1200px,94%);margin:0 auto;padding:8px 0 8px;display:flex;align-items:baseline;gap:6px;}
        .visual-collection-header span:first-child{font-family:'Playfair Display',serif;font-size:clamp(1.1rem,2.5vw,1.45rem);font-weight:400;color:#0f2233;letter-spacing:.3px;}
        .visual-collection-header span:last-child{font-family:'Playfair Display',serif;font-size:clamp(1.1rem,2.5vw,1.45rem);font-weight:600;font-style:italic;color:#0f2233;}
        .gallery-viewport{width:100%;overflow:hidden;position:relative;background:#111;}
        .gallery-track{display:flex;transition:transform 0.6s cubic-bezier(0.4,0,0.2,1);will-change:transform;cursor:grab;user-select:none;}
        .gallery-track.dragging{cursor:grabbing;transition:none;}
        .gallery-slide{flex:0 0 100%;display:grid;grid-template-columns:60fr 40fr 80px;height:480px;gap:3px;}
        .gallery-panel{overflow:hidden;position:relative;}
        .gallery-panel img{width:100%;height:100%;object-fit:cover;display:block;transition:transform 60ms ease;}
        .gallery-panel:hover img{transform:scale(1.03);}
        .gallery-peek{overflow:hidden;position:relative;}
        .gallery-peek img{width:100%;height:100%;object-fit:cover;display:block;}
        .gallery-nav{width:min(1200px,94%);margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:16px 0 24px;}
        .gallery-dots{display:flex;gap:7px;align-items:center;}
        .gallery-dot{width:7px;height:7px;border-radius:999px;border:0;padding:0;background:#c8d2db;cursor:pointer;transition:background 0.2s,width 0.25s;}
        .gallery-dot.active{background:#052f4a;width:22px;}
        .gallery-arrows{display:flex;gap:8px;}
        .gallery-arrow{width:40px;height:40px;border:1.5px solid #b0bec8;background:#fff;border-radius:999px;cursor:pointer;display:grid;place-items:center;font-size:1rem;color:#334155;transition:background 0.15s,border-color 0.15s;}
        .gallery-arrow:hover{background:#052f4a;border-color:#052f4a;color:#fff;}
        .gallery-arrow:disabled{opacity:.35;cursor:not-allowed;}
        .gallery-arrow:disabled:hover{background:#fff;border-color:#b0bec8;color:#334155;}
        .gallery-counter{font-size:.75rem;color:#6b7f8f;font-weight:600;letter-spacing:.5px;min-width:48px;text-align:center;}
        /* ‚îÄ‚îÄ VALUATION ‚îÄ‚îÄ */
        .valuation-wrap{background:#f5f6f8;}
        .val-eyebrow{font-size:.7rem;letter-spacing:2px;text-transform:uppercase;color:#6ed6e7;font-weight:700;margin-bottom:4px;}
        .val-sub{font-size:.8rem;color:#64748b;margin-bottom:22px;}

        /* Snapshot bar */
        .prop-snapshot{display:flex;background:#052f4a;color:#fff;border-radius:12px 12px 0 0;overflow:hidden;}
        .snap-main{flex:1;padding:18px 22px;}
        .snap-price{font-size:clamp(1.5rem,3vw,2.2rem);font-weight:800;letter-spacing:-.5px;transition:all .4s ease;}
        .snap-addr{font-size:.78rem;opacity:.75;margin-top:2px;}
        .snap-stats{display:flex;gap:20px;margin-top:10px;flex-wrap:wrap;}
        .snap-stat strong{display:block;font-size:1.1rem;font-weight:700;transition:all .4s ease;}
        .snap-stat span{font-size:.68rem;opacity:.7;text-transform:uppercase;letter-spacing:.5px;}
        .snap-meta{display:flex;flex-direction:column;border-left:1px solid rgba(255,255,255,.12);}
        .snap-meta-item{padding:12px 18px;border-bottom:1px solid rgba(255,255,255,.08);font-size:.75rem;}
        .snap-meta-item:last-child{border-bottom:0;}
        .snap-meta-item strong{display:block;font-size:.95rem;font-weight:700;transition:all .4s ease;}
        .snap-meta-lbl{opacity:.6;font-size:.65rem;text-transform:uppercase;letter-spacing:.5px;}

        /* Tabs */
        .val-tabs{display:flex;background:#fff;border:1px solid #d9dde3;border-top:0;overflow-x:auto;}
        .val-tab{border:0;background:transparent;padding:14px 22px;font-size:.85rem;font-weight:600;color:#64748b;border-bottom:3px solid transparent;cursor:pointer;white-space:nowrap;font-family:'Montserrat',sans-serif;transition:color .15s;}
        .val-tab.active{color:#052f4a;border-bottom-color:#6ed6e7;}
        .val-tab:hover{color:#052f4a;}
        .val-body{display:grid;grid-template-columns:minmax(0,1fr) 290px;gap:20px;margin-top:20px;align-items:start;}
        .val-panel{display:none;}
        .val-panel.active{display:block;}

        /* Value cards */
        .value-cards{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
        .value-card{background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:14px 16px;transition:all .3s ease;}
        .value-card.highlight{border-color:#6ed6e7;background:linear-gradient(135deg,#f0fbfd,#fff);}
        .vc-label{font-size:.68rem;color:#64748b;text-transform:uppercase;letter-spacing:.8px;font-weight:600;}
        .vc-amt{font-size:1.35rem;font-weight:800;color:#052f4a;margin-top:4px;transition:all .4s ease;}
        .vc-amt.loading{opacity:.4;}
        .vc-sub{font-size:.68rem;color:#64748b;margin-top:2px;transition:all .4s ease;}
        .yoy-badge{margin-top:6px;font-size:.68rem;font-weight:700;color:#0f766e;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:999px;padding:2px 8px;display:inline-block;transition:all .4s ease;}
        .yoy-badge.negative{color:#dc2626;background:#fef2f2;border-color:#fecaca;}

        /* Chart */
        .chart-card{background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:18px;}
        .chart-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px;}
        .trend-badge{font-size:.75rem;font-weight:700;color:#0f766e;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:999px;padding:3px 10px;}
        .chart-switch{display:flex;gap:6px;margin-bottom:14px;}
        .cs-btn{border:1px solid #d4dae1;background:#fff;padding:6px 12px;border-radius:999px;cursor:pointer;font-weight:600;font-size:.75rem;color:#334155;font-family:'Montserrat',sans-serif;}
        .cs-btn.active{border-color:#052f4a;color:#052f4a;background:#e8f4f8;}
        .chart-container{position:relative;height:220px;}
        .table-btn{border:0;background:none;color:#1558d6;font-weight:700;cursor:pointer;font-size:.78rem;font-family:'Montserrat',sans-serif;margin-top:10px;}

        /* Cost Calculator */
        .calc-net-box{text-align:center;background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:18px;margin-bottom:16px;}
        .calc-net-lbl{font-size:.7rem;color:#64748b;text-transform:uppercase;letter-spacing:1px;font-weight:600;}
        .calc-net-amt{font-size:2.2rem;font-weight:800;color:#052f4a;transition:all .3s ease;}
        .calc-net-amt.negative{color:#dc2626;}
        .calc-body{background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:18px;margin-bottom:16px;}
        .calc-row{margin-bottom:18px;}
        .calc-lbl{display:flex;justify-content:space-between;font-weight:600;font-size:.82rem;margin-bottom:8px;color:#1e293b;}
        input[type="range"]{width:100%;min-height:auto;border:none;padding:0;accent-color:#052f4a;cursor:pointer;}
        .acc-item{border-top:1px solid #e2e8f0;padding:12px 0;}
        .acc-trigger{width:100%;border:0;background:none;display:flex;justify-content:space-between;align-items:center;font-weight:700;font-size:.82rem;cursor:pointer;font-family:'Montserrat',sans-serif;color:#1e293b;padding:0;}
        .acc-trigger .chev{transition:transform .2s;font-style:normal;}
        .acc-item.open .acc-trigger .chev{transform:rotate(180deg);}
        .acc-body{display:none;margin-top:10px;}
        .acc-item.open .acc-body{display:block;}
        .line-item{display:flex;justify-content:space-between;border:1px solid #e2e8f0;border-radius:8px;padding:8px 12px;margin-bottom:6px;background:#f8fafc;font-size:.78rem;}
        .li-pct{color:#64748b;font-size:.72rem;}
        .total-row{display:flex;justify-content:space-between;font-weight:800;font-size:.9rem;padding:14px 0 4px;border-top:2px solid #052f4a;margin-top:8px;}
        .calc-note{font-size:.68rem;color:#94a3b8;margin-top:8px;line-height:1.5;}

        /* Owner/sell options */
        .owner-options{background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:20px;margin-bottom:16px;}
        .owner-options h3,.sell-options h3{font-size:1rem;font-weight:800;color:#1e293b;margin-bottom:16px;}
        .owner-opt-item{display:flex;gap:14px;align-items:flex-start;padding:14px 0;border-bottom:1px solid #f1f5f9;}
        .owner-opt-item:last-child{border-bottom:0;}
        .owner-opt-icon{width:44px;height:44px;border-radius:10px;background:#e8f5f0;display:grid;place-items:center;font-size:1.2rem;flex-shrink:0;}
        .owner-opt-text{flex:1;}
        .owner-opt-text strong{display:block;font-size:.88rem;font-weight:700;color:#1e293b;margin-bottom:3px;}
        .owner-opt-text p{font-size:.75rem;color:#64748b;line-height:1.5;margin-bottom:5px;}
        .owner-opt-text a{color:#0a5a8a;font-weight:700;font-size:.78rem;text-decoration:none;}
        .owner-opt-meta{text-align:right;flex-shrink:0;}
        .owner-opt-meta strong{display:block;font-size:.95rem;font-weight:800;color:#052f4a;transition:all .3s;}
        .owner-opt-meta span{font-size:.68rem;color:#64748b;}
        .sell-options{background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:20px;margin-bottom:16px;}
        .sell-opt-item{display:flex;gap:14px;align-items:flex-start;padding:12px 0;border-bottom:1px solid #f1f5f9;}
        .sell-opt-item:last-child{border-bottom:0;}
        .sell-opt-icon{width:40px;height:40px;border-radius:8px;background:#f0f7fb;display:grid;place-items:center;font-size:1.1rem;flex-shrink:0;}
        .sell-opt-text strong{display:block;font-size:.85rem;font-weight:700;color:#1e293b;margin-bottom:3px;}
        .sell-opt-text p{font-size:.75rem;color:#64748b;line-height:1.5;margin-bottom:5px;}
        .sell-opt-text a{color:#0a5a8a;font-weight:700;font-size:.78rem;text-decoration:none;}

        /* Home Details */
        .details-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;}
        .detail-card{background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:14px 16px;}
        .det-lbl{font-size:.65rem;color:#64748b;text-transform:uppercase;letter-spacing:.8px;font-weight:600;margin-bottom:4px;}
        .det-val{font-size:1rem;font-weight:700;color:#052f4a;transition:all .3s;}
        .det-sub{font-size:.7rem;color:#94a3b8;margin-top:2px;transition:all .3s;}
        .history-table{background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:18px;}
        .history-table h4{font-size:.88rem;font-weight:700;color:#052f4a;margin-bottom:10px;}
        .h-row{display:flex;justify-content:space-between;padding:9px 4px;border-bottom:1px solid #e5eaf0;font-size:.82rem;}
        .h-row.head{font-weight:800;border-bottom:2px solid #e5eaf0;}
        .h-row.sold{background:#fff7ed;font-weight:700;color:#c2410c;border-radius:6px;padding:8px 6px;}
        .h-row.zest{color:#052f4a;}
        .price-change{font-size:.7rem;margin-left:6px;}
        .price-change.up{color:#047857;}
        .price-change.down{color:#dc2626;}

        /* Unit Breakdown */
        .unit-occ-strip{display:flex;align-items:center;gap:14px;background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:12px 16px;margin-bottom:14px;flex-wrap:wrap;font-size:.78rem;color:#334155;}
        .unit-occ-item{display:flex;align-items:center;gap:6px;font-weight:600;}
        .unit-occ-dot{width:9px;height:9px;border-radius:50%;flex-shrink:0;}
        .unit-occ-bar-outer{flex:1;min-width:80px;height:7px;background:#e2eaf0;border-radius:999px;overflow:hidden;}
        .unit-occ-bar-fill{height:100%;border-radius:999px;background:linear-gradient(90deg,#047857,#10b981);transition:width .6s ease;}
        .unit-occ-pct{font-weight:800;color:#047857;font-size:.82rem;transition:all .3s;}
        .unit-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px;}
        .unit-search-input{border:1px solid #d9dde3;border-radius:6px;padding:8px 12px;font-family:'Montserrat',sans-serif;font-size:.8rem;width:200px;min-height:36px;}
        .unit-filter-row{display:flex;gap:6px;flex-wrap:wrap;}
        .unit-filter-btn{border:1px solid #d9dde3;background:#fff;padding:6px 13px;border-radius:999px;cursor:pointer;font-size:.73rem;font-weight:600;font-family:'Montserrat',sans-serif;color:#475569;transition:all .14s;}
        .unit-filter-btn.active{border-color:#052f4a;color:#052f4a;background:#e8f4f8;}
        .unit-table-wrap{border:1px solid #d9dde3;border-radius:10px;overflow:hidden;}
        .unit-table{width:100%;border-collapse:collapse;font-size:.79rem;}
        .unit-table thead{background:#f0f5f8;}
        .unit-table th{padding:11px 13px;text-align:left;font-size:.65rem;font-weight:700;color:#64748b;text-transform:uppercase;letter-spacing:.7px;border-bottom:1px solid #d9dde3;cursor:pointer;white-space:nowrap;user-select:none;}
        .unit-table th:hover{color:#052f4a;}
        .unit-table th.ut-sorted{color:#052f4a;}
        .th-sort{opacity:.45;margin-left:3px;}
        .unit-table th.ut-sorted .th-sort{opacity:1;}
        .unit-table td{padding:10px 13px;border-bottom:1px solid #f0f4f8;color:#1e293b;vertical-align:middle;}
        .unit-table tr:last-child td{border-bottom:0;}
        .unit-table tbody tr:hover td{background:#f8fbff;}
        .unit-table tfoot td{background:#f0f5f8;font-weight:700;font-size:.78rem;color:#052f4a;border-top:2px solid #d9dde3;padding:11px 13px;transition:all .3s;}
        .ut-pill{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:999px;font-size:.67rem;font-weight:700;white-space:nowrap;}
        .ut-pill.occupied{background:#f0fdf4;color:#047857;border:1px solid #bbf7d0;}
        .ut-pill.vacant{background:#fff7ed;color:#b45309;border:1px solid #fed7aa;}
        .ut-pill.listed{background:#eff6ff;color:#1558d6;border:1px solid #bfdbfe;}
        .ut-value-highlight{color:#052f4a;font-weight:700;}
        .msg-btn{display:inline-flex;align-items:center;justify-content:center;padding:5px 14px;border:1.5px solid #1558d6;border-radius:6px;background:#fff;color:#1558d6;font-size:.72rem;font-weight:700;font-family:'Montserrat',sans-serif;cursor:pointer;transition:background .14s,color .14s;white-space:nowrap;}
        .msg-btn:hover{background:#1558d6;color:#fff;}

        /* Side CTA */
        .side-cta{background:#fff;border:1px solid #d9dde3;border-radius:14px;padding:18px;position:sticky;top:80px;}
        .side-cta-lbl{font-size:.65rem;color:#64748b;text-transform:uppercase;letter-spacing:1px;font-weight:600;margin-bottom:4px;}
        .side-cta-val{font-size:1.6rem;font-weight:800;color:#052f4a;transition:all .4s ease;}
        .side-cta-sub{font-size:.72rem;color:#64748b;margin-bottom:14px;text-decoration:underline;cursor:pointer;transition:all .3s;}
        .cta-btn{width:100%;border:0;border-radius:10px;background:#052f4a;color:#fff;min-height:44px;font-weight:700;cursor:pointer;font-size:.85rem;font-family:'Montserrat',sans-serif;margin-top:8px;transition:background .15s;}
        .cta-btn:hover{background:#0d3f60;}
        .cta-btn.outline{background:transparent;border:1px solid #052f4a;color:#052f4a;}
        .cta-btn.outline:hover{background:#f0f7fb;}
        .cta-div{border:0;border-top:1px solid #e5eaf0;margin:14px 0;}
        .rent-chip{display:flex;justify-content:space-between;align-items:center;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;padding:10px 12px;margin-top:10px;}
        .rent-chip-lbl{font-size:.72rem;color:#334155;font-weight:600;transition:all .3s;}
        .rent-chip-val{font-size:1rem;font-weight:800;color:#0f766e;transition:all .4s ease;}
        .metric-row{font-size:.72rem;color:#64748b;line-height:1.9;}
        .metric-row strong{transition:all .3s;}

        /* Live indicator */
        .live-dot{display:inline-flex;align-items:center;gap:5px;font-size:.68rem;color:#047857;font-weight:600;margin-bottom:10px;}
        .live-dot::before{content:'';width:7px;height:7px;border-radius:50%;background:#10b981;animation:pulse 2s infinite;}
        @keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.5;transform:scale(1.3);}}
        .data-updating{opacity:.6;transition:opacity .2s;}

        /* Neighborhood */
        .nbhd-map-wrap{background:#fff;border:1px solid #d9dde3;border-radius:10px;overflow:hidden;margin-bottom:16px;}
        .nbhd-map-head{padding:14px 16px 0;}
        .nbhd-map-head h3{font-size:1rem;font-weight:800;color:#1e293b;margin-bottom:10px;}
        .nbhd-map-controls{display:flex;gap:8px;padding:0 16px 10px;}
        .map-ctrl-btn{display:flex;align-items:center;gap:5px;border:1px solid #d4dae1;background:#fff;padding:6px 12px;border-radius:6px;font-size:.75rem;font-weight:600;cursor:pointer;font-family:'Montserrat',sans-serif;}
        .map-ctrl-btn.active{background:#052f4a;color:#fff;border-color:#052f4a;}
        .nbhd-map-frame{width:100%;height:340px;border:0;border-top:1px solid #e5eaf0;}
        .transport-section{background:#fff;border:1px solid #d9dde3;border-radius:10px;padding:20px;margin-bottom:16px;}
        .transport-section h3{font-size:1rem;font-weight:800;color:#1e293b;margin-bottom:16px;}
        .score-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
        .score-card{display:flex;gap:12px;align-items:center;}
        .score-icon{width:48px;height:48px;border-radius:50%;display:grid;place-items:center;font-size:1.3rem;flex-shrink:0;background:#1a4731;color:#fff;}
        .score-info strong{display:block;font-size:1rem;font-weight:800;color:#1e293b;}
        .score-info .score-num{font-size:.72rem;color:#64748b;}
        .score-info .score-desc{font-size:.72rem;color:#64748b;display:block;margin-top:1px;}

        /* History modal */
        .hist-modal{position:fixed;inset:0;background:rgba(13,20,30,.5);display:none;align-items:center;justify-content:center;z-index:999;}
        .hist-modal.open{display:flex;}
        .hist-dialog{width:min(560px,92vw);max-height:80vh;overflow:auto;background:#fff;border-radius:14px;padding:24px;}
        .hist-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;font-weight:700;font-size:1rem;}
        .hist-close{border:0;background:none;font-size:1.3rem;cursor:pointer;color:#64748b;}
        .hist-row{display:flex;justify-content:space-between;padding:10px 8px;border-bottom:1px solid #e5eaf0;font-size:.85rem;}
        .hist-row.head{font-weight:800;border-bottom:2px solid #e5eaf0;color:#334155;}
        .hist-row.sold{background:#fff7ed;font-weight:700;color:#c2410c;border-radius:6px;padding:8px 6px;margin:2px 0;}

        /* Form */
        .location-layout{display:grid;grid-template-columns:1fr 1fr;background:#fff;border:1px solid var(--line);}
        .map-frame{width:100%;height:420px;border:0;}
        .location-panel{padding:24px;}
        .distance-item{display:grid;gap:6px;border:1px solid #e5e7eb;background:#f8fafc;padding:10px 12px;margin-bottom:4px;font-size:.85rem;}
        .form-shell{background:#fff;border:1px solid var(--line);padding:26px;}
        .form-head{display:flex;justify-content:space-between;align-items:baseline;gap:10px;margin-bottom:18px;}
        .privacy{color:var(--muted);font-size:.83rem;}
        .reg-grid{display:grid;grid-template-columns:repeat(3,minmax(160px,1fr));gap:8px;}
        input,select{width:100%;min-height:46px;border:1px solid #cfd6df;padding:10px 12px;font-family:inherit;background:#fff;}
        .toggle-group{display:flex;gap:18px;align-items:center;min-height:46px;border:1px solid #cfd6df;padding:10px 12px;background:#fff;}
        .hidden{display:none;}
        .consent-row{margin-top:14px;display:flex;gap:10px;align-items:flex-start;font-size:.88rem;color:#475569;}
        .submit-btn{margin-top:14px;border:0;background:var(--teal);color:#0f172a;font-weight:700;letter-spacing:.5px;min-height:48px;padding:0 24px;cursor:pointer;text-transform:uppercase;}
        .submit-btn:disabled{opacity:.55;cursor:not-allowed;}
        .success{margin-top:10px;color:#047857;font-weight:600;display:none;}
        .app-section{background:#fff;border:1px solid var(--line);padding:6px;display:grid;grid-template-columns:1fr 1fr;gap:20px;}
        .bullets{padding-left:20px;color:#334155;}
        .app-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;}
        .small-link{text-decoration:none;border:1px solid var(--line);padding:8px 12px;font-size:.82rem;background:#f8fafc;}

        /* Admin pill */
        .admin-link-pill{display:inline-flex;align-items:center;gap:6px;background:#1e293b;color:#6ed6e7;border:1px solid #334155;border-radius:999px;padding:5px 14px;font-size:.72rem;font-weight:700;text-decoration:none;letter-spacing:.5px;transition:all .2s;}
        .admin-link-pill:hover{background:#0d3f60;color:#fff;}

        /* ‚îÄ‚îÄ UNIT DETAIL MODAL ‚îÄ‚îÄ */
        .unit-detail-overlay{position:fixed;inset:0;background:rgba(13,20,30,.55);display:none;align-items:center;justify-content:center;z-index:1100;padding:20px;}
        .unit-detail-overlay.open{display:flex;}
        .unit-detail-dialog{background:#fff;border-radius:12px;width:min(880px,96vw);max-height:90vh;overflow-y:auto;display:grid;grid-template-columns:1fr 340px;position:relative;box-shadow:0 24px 60px rgba(0,0,0,.25);}
        .ud-left{padding:28px 24px;border-right:1px solid #e5eaf0;}
        .ud-back{display:inline-flex;align-items:center;gap:6px;font-size:.78rem;font-weight:600;color:#334155;cursor:pointer;border:0;background:none;font-family:'Montserrat',sans-serif;margin-bottom:18px;padding:0;}
        .ud-back:hover{color:#052f4a;}
        .ud-floorplan{background:#f0f4f8;border:1px solid #d9dde3;border-radius:8px;height:270px;display:flex;align-items:center;justify-content:center;margin-bottom:16px;position:relative;overflow:hidden;}
        .ud-floorplan svg{width:200px;height:auto;opacity:.55;}
        .ud-floorplan-label{position:absolute;top:10px;left:10px;background:#fff;border:1px solid #d9dde3;border-radius:4px;padding:3px 8px;font-size:.65rem;font-weight:700;color:#334155;display:flex;align-items:center;gap:4px;}
        .ud-chips{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;}
        .ud-chip{border:1px solid #e5eaf0;border-radius:8px;padding:9px 11px;font-size:.73rem;color:#475569;display:flex;align-items:center;gap:7px;}
        .ud-chip strong{color:#1e293b;font-size:.8rem;}
        .ud-about h4{font-size:.85rem;font-weight:700;color:#1e293b;margin-bottom:8px;}
        .ud-lease-head{font-size:.8rem;font-weight:700;color:#1e293b;margin-bottom:4px;}
        .ud-lease-item{display:flex;align-items:flex-start;gap:6px;font-size:.77rem;color:#475569;margin-bottom:4px;padding-left:2px;}
        .ud-lease-item::before{content:'‚Ä¢';color:#94a3b8;flex-shrink:0;}
        .ud-building-head{font-size:.8rem;font-weight:700;color:#1e293b;margin:10px 0 4px;}
        .ud-right{padding:28px 20px;}
        .ud-close{position:absolute;top:12px;right:14px;border:0;background:none;font-size:1.4rem;cursor:pointer;color:#64748b;line-height:1;z-index:10;}
        .ud-close:hover{color:#052f4a;}
        .ud-unit-title{font-size:1.25rem;font-weight:800;color:#1e293b;margin-bottom:2px;}
        .ud-unit-sub{font-size:.85rem;color:#334155;margin-bottom:4px;}
        .ud-fees-note{font-size:.67rem;color:#94a3b8;margin-bottom:16px;line-height:1.5;}
        .ud-tour-btn{width:100%;background:#1558d6;color:#fff;border:0;border-radius:8px;min-height:48px;font-weight:700;font-size:.88rem;cursor:pointer;font-family:'Montserrat',sans-serif;margin-bottom:10px;display:flex;align-items:center;justify-content:center;gap:6px;flex-direction:column;transition:background .15s;}
        .ud-tour-btn:hover{background:#1240a8;}
        .ud-tour-sub{font-size:.63rem;font-weight:400;opacity:.85;}
        .ud-apply-btn{width:100%;background:#fff;color:#1558d6;border:1.5px solid #1558d6;border-radius:8px;min-height:46px;font-weight:700;font-size:.88rem;cursor:pointer;font-family:'Montserrat',sans-serif;margin-bottom:16px;transition:background .15s;}
        .ud-apply-btn:hover{background:#eff6ff;}
        .ud-floor-notice{background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:11px 13px;font-size:.73rem;color:#334155;display:flex;align-items:flex-start;gap:8px;margin-bottom:16px;}
        .ud-cost-section{border-top:1px solid #e5eaf0;padding-top:14px;}
        .ud-cost-title{font-size:.82rem;font-weight:700;color:#1e293b;margin-bottom:10px;}
        .ud-cost-group{border:1px solid #e5eaf0;border-radius:8px;overflow:hidden;margin-bottom:10px;}
        .ud-cost-group-head{background:#f8fafc;padding:10px 12px;font-size:.75rem;font-weight:700;color:#334155;}
        .ud-cost-row{display:flex;justify-content:space-between;padding:7px 12px;font-size:.77rem;color:#475569;border-top:1px solid #f0f4f8;}
        .ud-cost-row.total-row-ud{font-weight:800;color:#1e293b;background:#f8fafc;}
        .ud-cost-section-label{font-size:.68rem;font-weight:700;color:#94a3b8;text-transform:uppercase;letter-spacing:.5px;padding:7px 12px 3px;}
        .ud-estimated-total{display:flex;justify-content:space-between;align-items:center;padding:10px 0 0;border-top:1px solid #e5eaf0;font-size:.82rem;font-weight:800;color:#1e293b;margin-top:4px;}

        /* ‚îÄ‚îÄ APPLY POPUP ‚îÄ‚îÄ */
        .apply-overlay{position:fixed;inset:0;background:rgba(13,20,30,.6);display:none;align-items:center;justify-content:center;z-index:1300;padding:20px;}
        .apply-overlay.open{display:flex;}
        .apply-dialog{background:#fff;border-radius:10px;width:min(520px,96vw);padding:28px;position:relative;box-shadow:0 24px 60px rgba(0,0,0,.28);max-height:90vh;overflow-y:auto;}
        .apply-close{position:absolute;top:14px;right:16px;border:0;background:none;font-size:1.4rem;cursor:pointer;color:#64748b;}
        .apply-close:hover{color:#052f4a;}
        .apply-title{font-size:1.05rem;font-weight:700;color:#1e293b;margin-bottom:18px;text-align:center;}
        .apply-field{margin-bottom:13px;}
        .apply-field label{display:block;font-size:.73rem;font-weight:600;color:#475569;margin-bottom:4px;}
        .apply-field input,.apply-field textarea{width:100%;border:1px solid #cfd6df;border-radius:6px;padding:9px 12px;font-family:'Montserrat',sans-serif;font-size:.82rem;min-height:40px;background:#fff;resize:vertical;}
        .apply-field textarea{min-height:86px;}
        .apply-field input:focus,.apply-field textarea:focus{outline:2px solid #1558d6;border-color:#1558d6;}
        .apply-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
        .apply-consent{font-size:.67rem;color:#64748b;line-height:1.6;margin-bottom:14px;padding:10px;background:#f8fafc;border-radius:6px;border:1px solid #e5eaf0;}
        .apply-send-btn{width:100%;background:#1558d6;color:#fff;border:0;border-radius:8px;min-height:46px;font-weight:700;font-size:.9rem;cursor:pointer;font-family:'Montserrat',sans-serif;transition:background .15s;}
        .apply-send-btn:hover{background:#1240a8;}
        .apply-success{display:none;text-align:center;padding:24px 0;}
        .apply-checkmark{font-size:2.8rem;display:block;margin-bottom:10px;}
        .apply-success-msg{font-weight:700;font-size:.95rem;color:#047857;}

        @media(max-width:980px){.val-body{grid-template-columns:1fr;}.side-cta{position:static;}.value-cards{grid-template-columns:1fr 1fr;}.prop-snapshot{flex-direction:column;}.snap-meta{border-left:0;border-top:1px solid rgba(255,255,255,.12);flex-direction:row;flex-wrap:wrap;}.snap-meta-item{border-right:1px solid rgba(255,255,255,.08);border-bottom:0;}}
        @media(max-width:960px){.split,.location-layout,.app-section{grid-template-columns:1fr;}.reg-grid{grid-template-columns:repeat(2,minmax(150px,1fr));}.project-badge{left:20%;}.menu{display:none;}.hero{min-height:58vh;}.details-grid{grid-template-columns:1fr;}.unit-table-wrap{overflow-x:auto;}.unit-table{min-width:720px;}.score-grid{grid-template-columns:1fr 1fr;}}
        @media(max-width:640px){.amenities-grid{grid-template-columns:repeat(2,1fr);}.reg-grid{grid-template-columns:1fr;}.intro-btn{width:100%;}.project-badge{width:152px;height:130px;top:-52px;left:12%;}.hero{min-height:52vh;}.value-cards{grid-template-columns:1fr;}.val-tab{padding:12px 14px;font-size:.78rem;}.score-grid{grid-template-columns:1fr;}}
    </style>
</head>
<body>

<header class="site-header">
    <div class="header-inner">
        <a class="logo" href="index.html">TAISEEL</a>
        <nav class="menu">
            <a href="#overview">New Launches</a>
            <a href="#visual-collection">Visual Collection</a>
            <a href="#valuation">Home Value</a>
            <a href="#location">Location</a>
            <a href="#register">Register</a>
        </nav>
        <a class="admin-link-pill" href="admin.html">üìä Admin Panel</a>
    </div>
</header>

<section class="hero" id="overview">
    <div class="container"><div class="hero-card" aria-hidden="true"></div></div>
</section>

<section class="section intro-section">
    <div class="container split">
        <div class="project-badge" aria-hidden="true">
            <div class="badge-mark">N</div>
            <div class="badge-name">Brilliant Tower</div>
        </div>
        <article class="card intro-offset-down">
            <h1 class="project-title">Brilliant Tower</h1>
            <h2>A Calm Called Home.</h2>
            <p class="lead">Premium residential building in the heart of Brilliant Tower, Kigali. A curated collection of 20 bespoke residences designed for those who demand excellence in every detail.</p>
            <div class="action-box">
                <a class="intro-btn primary" href="#register">Register Your Interest</a>
                <a class="intro-btn" href="#valuation">View Valuation</a>
                <a class="intro-btn" href="admin.html">üìä Admin Panel</a>
                <a class="intro-btn" href="Brilliant Tower Brochure.pdf" download>Download Brochure</a>
                <a class="intro-btn" href="Brilliant Tower Floor Plan.pdf" download>Download Floor Plan</a>
                <a class="intro-btn" href="Brilliant Tower Prices and Payment Plan.pdf" download>Download Payment Plan</a>                
            </div>
        </article>
        <article class="card intro-offset-down">
            <h2>Amenities</h2>
            <div class="amenities-grid" id="amenities-grid"></div>
            <div class="amenity-pager" id="amenity-dots"></div>
        </article>
    </div>
</section>

<section id="visual-collection">
    <div class="visual-collection-header"><span>Visual</span>&nbsp;<span>Collection</span></div>
     <div class="gallery-viewport">
     <div class="gallery-track" id="gallery-track"style="transform:translateX(0)";>
     <div class="gallery-slide">
      <div class="gallery-panel">
        <img src="baygrove.png" alt="visual 1"loading="lazy">   
     </div>
      <div class="gallery-panel">
       <img src="VisionCity2.jpg" alt loading="lazy">
      </div>
         <div class="gallery-peek">
          <img src="kigaliheight2.jpg" alt loading="lazy">
         </div>
      </div>
    <div class="gallery-slide">
     <div class="gallery-panel">
        <img src="VisionCity2.jpg" alt="visual 2" loading="lazy">   
      </div>
     <div class="gallery-panel">
        <img src="kigaliheight2.jpg" alt loading="lazy">
        </div>
    <div class="gallery-peek">
      <img src="landscape4.jpg" alt loading="lazy">
    </div>
    </div>
    <div class="gallery-slide">
     <div class="gallery-panel">
      <img src="kigaliheight2.jpg" alt="visual 3" loading="lazy">   
     </div>
     <div class="gallery-panel">
      <img src="landscape4.jpg" alt loading="lazy">
     </div>
     <div class="gallery-peek">
      <img src="baygrove.png" alt loading="lazy">
     </div>
    </div>
    <div class="gallery-slide">
     <div class="gallery-panel">
      <img src="landscape4.jpg" alt="visual 4" loading="lazy">   
     </div>
     <div class="gallery-panel">
      <img src="baygrove.png" alt loading="lazy">
     </div>
     <div class="gallery-peek">
      <img src="VisionCity2.jpg" alt loading="lazy">
     </div>
    </div>
    </div>
    </div>
    <div class="gallery-nav">
        <div class="gallery-dots" id="gallery-dots">
            <button class="gallery-dot active" aria-label="Go to image 1"></button>
            <button class="gallery-dot" aria-label="Go to image 2"></button>
            <button class="gallery-dot" aria-label="Go to image 3"></button>
            <button class="gallery-dot" aria-label="Go to image 4"></button>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
            <span class="gallery-counter" id="gallery-counter">01 / 04</span>
            <div class="gallery-arrows">
                <button class="gallery-arrow" id="gallery-prev" aria-label="Previous">‚Üê</button>
                <button class="gallery-arrow" id="gallery-next" aria-label="Next">‚Üí</button>
            </div>
        </div>
    </div>
</section>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VALUATION SECTION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section class="valuation-wrap" id="valuation">
    <div class="container" style="padding:30px 0;">
        <div class="live-dot" id="live-indicator">Live data ¬∑ auto-refreshes every 15 seconds</div>
        <div class="val-eyebrow">Real Estate Intelligence</div>
        <div class="val-sub">Live market data connected to unit values ¬∑ comparable sales ¬∑ estimated returns ‚Äî all in one place.</div>

        <!-- SNAPSHOT BAR -->
        <div class="prop-snapshot">
            <div class="snap-main">
                <div class="snap-price" id="snap-building-total">$24,120,000</div>
                <div class="snap-addr">Brilliant Tower ¬∑ Brilliant Tower, Kigali ‚Äî 20-Unit Residential Building</div>
                <div class="snap-stats">
                    <div class="snap-stat"><strong id="snap-total-units">20</strong><span>Total Units</span></div>
                    <div class="snap-stat"><strong id="snap-occupied">17</strong><span>Occupied</span></div>
                    <div class="snap-stat"><strong>6</strong><span>Floors</span></div>
                    <div class="snap-stat"><strong id="snap-avg-unit">$1.21M</strong><span>Avg / Unit</span></div>
                    <div class="snap-stat"><strong id="snap-occupancy">85%</strong><span>Occupancy</span></div>
                    <div class="snap-stat"><strong id="snap-sqft">25,480</strong><span>Total sqft</span></div>
                </div>
            </div>
            <div class="snap-meta">
                <div class="snap-meta-item"><div class="snap-meta-lbl">Type</div><strong>Apartment Block</strong></div>
                <div class="snap-meta-item"><div class="snap-meta-lbl">Year Built</div><strong>2022</strong></div>
                <div class="snap-meta-item"><div class="snap-meta-lbl">Total Area</div><strong id="snap-total-sqft">25,480 sqft</strong></div>
                <div class="snap-meta-item"><div class="snap-meta-lbl">Rent Roll</div><strong id="snap-rent-roll">$67,320/mo</strong></div>
            </div>
        </div>

        <!-- TABS -->
        <div class="val-tabs">
            <button class="val-tab active" data-tab="home-value">Home Value</button>
            <button class="val-tab" data-tab="cost-calc">Cost Calculator</button>
            <button class="val-tab" data-tab="home-details">Home Details</button>
            <button class="val-tab" data-tab="neighborhood">Neighborhood</button>
            <button class="val-tab" data-tab="unit-breakdown">Unit Breakdown</button>
        </div>

        <div class="val-body">
            <div>

                <!-- ‚ïê‚ïê HOME VALUE PANEL ‚ïê‚ïê -->
                <div class="val-panel active" id="panel-home-value">
                    <div class="value-cards">
                        <div class="value-card">
                            <div class="vc-label">Building Zestimate¬Æ</div>
                            <div class="vc-amt" id="vc-building-total">$24,120,000</div>
                            <div class="vc-sub" id="vc-building-sub">Total estimated value ¬∑ 20 units</div>
                        </div>
                        <div class="value-card highlight">
                            <div class="vc-label" style="color:#0a6a7a;">Per Unit Estimate</div>
                            <div class="vc-amt" style="color:#052f4a;" id="vc-per-unit">$1,206,000</div>
                            <div class="vc-sub" id="vc-per-unit-sub">Average across all 20 units</div>
                            <div class="yoy-badge" id="vc-yoy-badge">‚Üë +8.4% YoY</div>
                        </div>
                        <div class="value-card">
                            <div class="vc-label">Sales Range (per unit)</div>
                            <div class="vc-amt" style="font-size:1rem;padding-top:4px;" id="vc-sales-range">$1.14M ‚Äì $1.27M</div>
                            <div class="vc-sub">¬±6% confidence interval</div>
                        </div>
                        <div class="value-card">
                            <div class="vc-label">Monthly Rent Roll</div>
                            <div class="vc-amt" id="vc-rent-roll">$67,320<span style="font-size:.85rem;font-weight:600;">/mo</span></div>
                            <div class="vc-sub" id="vc-rent-roll-sub">17 occupied ¬∑ $3,960 avg/unit</div>
                        </div>
                    </div>

                    <!-- Investment KPIs -->
                    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px;">
                        <div class="value-card" style="text-align:center;">
                            <div class="vc-label">Gross Yield</div>
                            <div class="vc-amt" style="color:#0f766e;font-size:1.5rem;" id="vc-gross-yield">3.35%</div>
                        </div>
                        <div class="value-card" style="text-align:center;">
                            <div class="vc-label">Occupancy Rate</div>
                            <div class="vc-amt" style="font-size:1.5rem;" id="vc-occupancy-rate">85%</div>
                        </div>
                        <div class="value-card" style="text-align:center;">
                            <div class="vc-label">Price / sqft</div>
                            <div class="vc-amt" style="font-size:1.3rem;" id="vc-price-sqft">$947</div>
                        </div>
                        <div class="value-card" style="text-align:center;">
                            <div class="vc-label">Total Return</div>
                            <div class="vc-amt" style="color:#0f766e;font-size:1.5rem;" id="vc-total-return">~12.1%</div>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-head">
                            <div>
                                <div style="font-weight:700;font-size:.9rem;color:#052f4a;">Building Value History ¬∑ Per Unit Avg</div>
                                <div class="trend-badge" id="trend-label">+101% portfolio growth in 6 years</div>
                            </div>
                            <button class="table-btn" id="open-history">Table view ‚Ä∫</button>
                        </div>
                        <div class="chart-switch">
                            <button class="cs-btn active" data-chart="value">Building Total</button>
                            <button class="cs-btn" data-chart="rent">Rent Roll</button>
                            <button class="cs-btn" data-chart="tax">Per Unit Avg</button>
                        </div>
                        <div class="chart-container"><canvas id="valueChart"></canvas></div>
                        <div id="chart-x-labels" style="display:flex;justify-content:space-between;color:#64748b;font-size:.75rem;margin-top:8px;"></div>
                    </div>
                </div>

                <!-- ‚ïê‚ïê COST CALCULATOR PANEL ‚ïê‚ïê -->
                <div class="val-panel" id="panel-cost-calc">
                    <div class="calc-net-box">
                        <div class="calc-net-lbl">Estimated Net Proceeds (Building)</div>
                        <div class="calc-net-amt" id="net-proceeds">$0</div>
                        <div style="font-size:.72rem;color:#64748b;margin-top:4px;">Based on full building sale at current Zestimate¬Æ</div>
                    </div>
                    <div class="calc-body">
                        <div class="calc-row">
                            <div class="calc-lbl">
                                <span>Est. selling price of building</span>
                                <span id="sell-price-display">$24,120,000</span>
                            </div>
                            <input type="range" id="sell-price-range" min="10000000" max="40000000" step="10000" value="24120000">
                            <div style="display:flex;justify-content:space-between;font-size:.68rem;color:#94a3b8;margin-top:4px;"><span>$10M</span><span>$40M</span></div>
                        </div>
                        <div class="calc-row">
                            <div class="calc-lbl">
                                <span>Est. remaining mortgage (total)</span>
                                <span id="mortgage-display">$0</span>
                            </div>
                            <input type="range" id="mortgage-range" min="0" max="20000000" step="10000" value="0">
                            <div style="display:flex;justify-content:space-between;font-size:.68rem;color:#94a3b8;margin-top:4px;"><span>$0</span><span>$20M</span></div>
                        </div>
                        <div class="acc-item open">
                            <button class="acc-trigger" type="button">
                                <span>Est. prep &amp; repair costs <span style="color:#64748b;font-weight:400;">$120,000</span></span>
                                <i class="chev">‚ñæ</i>
                            </button>
                            <div class="acc-body">
                                <div class="line-item"><span>Building maintenance &amp; staging</span><span>$80,000</span></div>
                                <div class="line-item"><span>Professional photography &amp; marketing</span><span>$40,000</span></div>
                            </div>
                        </div>
                        <div class="acc-item open">
                            <button class="acc-trigger" type="button">
                                <span>Est. closing costs <span style="color:#64748b;font-weight:400;" id="closing-display">$0</span></span>
                                <i class="chev">‚ñæ</i>
                            </button>
                            <div class="acc-body">
                                <div class="line-item"><span>Agent commission <span class="li-pct">(6%)</span></span><span id="commission-display">$0</span></div>
                                <div class="line-item"><span>Selling concessions <span class="li-pct">(1%)</span></span><span id="concessions-display">$0</span></div>
                                <div class="line-item"><span>Closing fees <span class="li-pct">(0.6%)</span></span><span id="closing-fees-display">$0</span></div>
                                <div class="line-item"><span>Transfer taxes <span class="li-pct">(0.5%)</span></span><span id="taxes-display">$0</span></div>
                            </div>
                        </div>
                        <div class="total-row">
                            <span>Est. total selling costs</span>
                            <span id="total-costs-display">$0</span>
                        </div>
                        <div class="calc-note">All calculations are estimates for informational purposes only. Selling price auto-populates from live Building Zestimate¬Æ. Adjust sliders to model different scenarios.</div>
                    </div>
                    <div class="owner-options">
                        <h3>Owner options</h3>
                        <div class="owner-opt-item">
                            <div class="owner-opt-icon">üîë</div>
                            <div class="owner-opt-text">
                                <strong>List your units for rent</strong>
                                <p>Find tenants for vacant units. With online applications, you can quickly screen prospective tenants.</p>
                                <a href="#register">Learn more</a>
                            </div>
                            <div class="owner-opt-meta">
                                <strong id="owner-rent-zest">$67,320/mo</strong>
                                <span>Building Rent Roll</span>
                            </div>
                        </div>
                        <div class="owner-opt-item">
                            <div class="owner-opt-icon">üí∞</div>
                            <div class="owner-opt-text">
                                <strong>Refinance and save</strong>
                                <p>Refinancing the building at lower rates could reduce monthly payments and save significantly over time.</p>
                                <a href="#register">See today's rates</a>
                            </div>
                            <div class="owner-opt-meta">
                                <strong id="owner-gross-yield">3.35%</strong>
                                <span>Gross Yield</span>
                            </div>
                        </div>
                    </div>
                    <div class="sell-options">
                        <h3>Explore your selling options</h3>
                        <div class="sell-opt-item">
                            <div class="sell-opt-icon">üèÜ</div>
                            <div class="sell-opt-text">
                                <strong>Work with a Taiseel partner agent</strong>
                                <p>Leverage their expertise and Taiseel's premium listings to reach high-net-worth buyers.</p>
                                <a href="#register">Get started</a>
                            </div>
                        </div>
                        <div class="sell-opt-item">
                            <div class="sell-opt-icon">üè†</div>
                            <div class="sell-opt-text">
                                <strong>Sell unit by unit</strong>
                                <p>Maximize total proceeds by selling individual units separately to end-users or investors.</p>
                                <a href="#register">Learn how</a>
                            </div>
                        </div>
                        <div class="sell-opt-item">
                            <div class="sell-opt-icon">ü§ù</div>
                            <div class="sell-opt-text">
                                <strong>Off-market portfolio sale</strong>
                                <p>Sell the entire building to an institutional investor without listing publicly.</p>
                                <a href="#register">Contact us</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚ïê‚ïê HOME DETAILS PANEL ‚ïê‚ïê -->
                <div class="val-panel" id="panel-home-details">
                    <div class="details-grid">
                        <div class="detail-card"><div class="det-lbl">Property Type</div><div class="det-val">Apartment Building</div></div>
                        <div class="detail-card"><div class="det-lbl">Year Built</div><div class="det-val">2022</div><div class="det-sub">3 years old</div></div>
                        <div class="detail-card"><div class="det-lbl">Total Living Area</div><div class="det-val" id="det-total-sqft">25,480 sqft</div><div class="det-sub" id="det-price-sqft">$947 / sqft</div></div>
                        <div class="detail-card"><div class="det-lbl">Total Units</div><div class="det-val" id="det-total-units">20 units</div><div class="det-sub">6 floors</div></div>
                        <div class="detail-card"><div class="det-lbl">Occupied Units</div><div class="det-val" id="det-occupied">17 / 20</div><div class="det-sub" id="det-occupancy-pct">85% occupancy</div></div>
                        <div class="detail-card"><div class="det-lbl">Total Bedrooms</div><div class="det-val" id="det-bedrooms">‚Äî</div></div>
                        <div class="detail-card"><div class="det-lbl">Parking</div><div class="det-val">20 spaces</div><div class="det-sub">1 per unit</div></div>
                        <div class="detail-card"><div class="det-lbl">Zoning</div><div class="det-val">Residential</div><div class="det-sub">Brilliant tower, Kigali</div></div>
                    </div>

                    <!-- Dynamic Price History from API -->
                    <div class="history-table">
                        <h4>Building Valuation History</h4>
                        <div class="h-row head">
                            <span>Period</span>
                            <span>Building Value</span>
                            <span>Per Unit Avg</span>
                            <span>Rent Roll</span>
                            <span>Change</span>
                        </div>
                        <div id="price-history-rows">
                            <div class="h-row" style="justify-content:center;color:#94a3b8;padding:20px;">Loading history...</div>
                        </div>
                    </div>
                </div>

                <!-- ‚ïê‚ïê NEIGHBORHOOD ‚ïê‚ïê -->
                <div class="val-panel" id="panel-neighborhood">
                    <div class="nbhd-map-wrap">
                        <div class="nbhd-map-head"><h3>Brilliant Tower, Kigali</h3></div>
                        <div class="nbhd-map-controls">
                            <button class="map-ctrl-btn active">üó∫ Street</button>
                            <button class="map-ctrl-btn">üöó Road</button>
                            <button class="map-ctrl-btn">üõ∞ Satellite</button>
                        </div>
                        <iframe class="nbhd-map-frame" title="Brilliant Tower map" src="https://www.openstreetmap.org/export/embed.html?bbox=30.0482%2C-1.9527%2C30.0582%2C-1.9427&layer=mapnik&marker=-1.9477%2C30.0532" loading="lazy"></iframe>
                    </div>
                    <div class="transport-section">
                        <h3>Getting around</h3>
                        <div class="score-grid">
                            <div class="score-card"><div class="score-icon">üö∂</div><div class="score-info"><strong>Walk Score¬Æ</strong><span class="score-num">42 / 100</span><span class="score-desc">Car-Dependent</span></div></div>
                            <div class="score-card"><div class="score-icon">üöå</div><div class="score-info"><strong>Transit Score¬Æ</strong><span class="score-num">65 / 100</span><span class="score-desc">Excellent Transit</span></div></div>
                            <div class="score-card"><div class="score-icon">üö≤</div><div class="score-info"><strong>Bike Score¬Æ</strong><span class="score-num">35 / 100</span><span class="score-desc">Bikeable</span></div></div>
                        </div>
                    </div>
                </div>

                <!-- ‚ïê‚ïê UNIT BREAKDOWN ‚ïê‚ïê -->
                <div class="val-panel" id="panel-unit-breakdown">
                    <div class="unit-occ-strip">
                        <div class="unit-occ-item"><span class="unit-occ-dot" style="background:#047857;"></span><strong id="occ-occupied-count">17</strong>&nbsp;Occupied</div>
                        <div class="unit-occ-item"><span class="unit-occ-dot" style="background:#b45309;"></span><strong id="occ-vacant-count">2</strong>&nbsp;Vacant</div>
                        <div class="unit-occ-item"><span class="unit-occ-dot" style="background:#1558d6;"></span><strong id="occ-listed-count">1</strong>&nbsp;Listed</div>
                        <div class="unit-occ-bar-outer"><div class="unit-occ-bar-fill" id="occ-bar" style="width:85%;"></div></div>
                        <span class="unit-occ-pct" id="occ-pct-label">85% occupied</span>
                    </div>
                    <div class="unit-controls">
                        <input class="unit-search-input" id="unit-search" type="text" placeholder="Search unit, type, floor‚Ä¶">
                        <div class="unit-filter-row" id="unit-filters">
                            <button class="unit-filter-btn active" data-filter="all">All (20)</button>
                            <button class="unit-filter-btn" data-filter="occupied">Occupied</button>
                            <button class="unit-filter-btn" data-filter="vacant">Vacant</button>
                            <button class="unit-filter-btn" data-filter="listed">Listed</button>
                        </div>
                    </div>
                    <div class="unit-table-wrap">
                        <table class="unit-table">
                            <thead>
                                <tr>
                                    <th data-col="unit">Unit <span class="th-sort">‚Üï</span></th>
                                    <th data-col="floor">Floor <span class="th-sort">‚Üï</span></th>
                                    <th data-col="type">Type <span class="th-sort">‚Üï</span></th>
                                    <th data-col="sqft">Sqft <span class="th-sort">‚Üï</span></th>
                                    <th data-col="value">Est. Value <span class="th-sort">‚Üï</span></th>
                                    <th data-col="rent">Rent / mo <span class="th-sort">‚Üï</span></th>
                                    <th data-col="yield">Yield <span class="th-sort">‚Üï</span></th>
                                    <th data-col="status">Status <span class="th-sort">‚Üï</span></th>
                                    <th style="cursor:default;"></th>
                                </tr>
                            </thead>
                            <tbody id="unit-tbody">
                                <tr><td colspan="9" style="text-align:center;padding:30px;color:#94a3b8;">Loading units‚Ä¶</td></tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="3" id="tfoot-summary">Totals / Avg</td>
                                    <td id="tfoot-sqft">‚Äî</td>
                                    <td id="tfoot-value">‚Äî</td>
                                    <td id="tfoot-rent">‚Äî</td>
                                    <td id="tfoot-yield">‚Äî</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div style="font-size:.68rem;color:#94a3b8;margin-top:8px;line-height:1.5;">* Values are Zestimate¬Æ estimates derived from live unit data. Vacant units show market-rate estimates. Yields calculated on asking/market rent against estimated unit value.</div>
                </div>

            </div>

            <!-- ‚ïê‚ïê SIDE CTA ‚ïê‚ïê -->
            <div class="side-cta">
                <div class="live-dot" style="margin-bottom:8px;">Live</div>
                <div class="side-cta-lbl">Building Zestimate¬Æ</div>
                <div class="side-cta-val" id="side-building-total">$24,120,000</div>
                <div class="side-cta-sub" id="side-per-unit-sub">Per unit avg: $1,206,000</div>
                <div class="side-cta-sub" style="color:#0a5a8a;font-size:.68rem;">What is this number?</div>
                <button class="cta-btn" onclick="document.getElementById('register').scrollIntoView({behavior:'smooth'})">Request Full Valuation</button>
                <button class="cta-btn outline" style="margin-top:8px;" onclick="document.getElementById('register').scrollIntoView({behavior:'smooth'})">Schedule Site Visit</button>
                <hr class="cta-div">
                <div class="side-cta-lbl">Monthly Rent Roll</div>
                <div class="rent-chip">
                    <span class="rent-chip-lbl" id="side-rent-detail">17 units ¬∑ $3,960 avg</span>
                    <span class="rent-chip-val" id="side-rent-total">$67,320</span>
                </div>
                <hr class="cta-div">
                <div class="metric-row">
                    <strong style="color:#1e293b;display:block;margin-bottom:6px;">Investment Metrics</strong>
                    üè† Gross Yield <strong style="color:#0f766e;" id="side-gross-yield">3.35%</strong><br>
                    üìà Appreciation <strong style="color:#0f766e;" id="side-appreciation">+8.4% YoY</strong><br>
                    üí∞ Total Return <strong style="color:#0f766e;" id="side-total-return">~12.1% / yr</strong><br>
                    üè¢ Occupancy <strong style="color:#0f766e;" id="side-occupancy">85% (17/20)</strong><br>
                    üìê Price / sqft <strong id="side-price-sqft">$947</strong>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- History Modal -->
<div class="hist-modal" id="history-modal">
    <div class="hist-dialog">
        <div class="hist-head">
            <span>Building Valuation History</span>
            <button class="hist-close" id="close-history">‚úï</button>
        </div>
        <div class="hist-row head">
            <span>Period</span>
            <span>Building Value</span>
            <span>Rent Roll</span>
            <span>Per Unit Avg</span>
        </div>
        <div id="history-modal-list"></div>
    </div>
</div>

<section class="section" id="location">
    <div class="container">
        <div class="location-layout">
            <iframe class="map-frame" title="Brilliant Tower location map" src="https://www.openstreetmap.org/export/embed.html?bbox=30.0482%2C-1.9527%2C30.0582%2C-1.9427&layer=mapnik&marker=-1.9477%2C30.0532"></iframe>
            <div class="location-panel">
                <h2>The Location</h2>
                <div class="distance-item">16 minutes from Life Pharmacy Metro Station</div>
                <div class="distance-item">22 minutes from Dubai Frame</div>
                <div class="distance-item">24 minutes from Dubai World Trade Centre</div>
                <div class="distance-item">24 minutes from Downtown Dubai</div>
                <div class="distance-item">33 minutes from Business Bay</div>
                <div class="distance-item">34 minutes from Dubai Financial Centre</div>
            </div>
        </div>
    </div>
</section>

<section class="section" id="register">
    <div class="container">
        <div class="form-shell">
            <div class="form-head"><h2 style="margin-bottom:0;">Register Your Interest</h2><p class="privacy">Taiseel privacy policy explains how we handle your personal data.</p></div>
            <form id="interest-form" novalidate>
                <div class="reg-grid">
                    <input type="text" name="First Name" placeholder="First Name*" required>
                    <input type="text" name="Last Name" placeholder="Last Name*" required>
                    <input type="email" name="Email Address" placeholder="Email Address*" required>
                    <select name="country" required><option value="">Country of Residence*</option><option value="AE">UAE</option><option value="RW">Rwanda</option><option value="US">United States</option><option value="UK">United Kingdom</option><option value="Other">Other</option></select>
                    <select name="bedrooms" required><option value="">No of Bedrooms*</option><option value="Studio">Studio</option><option value="1">1 Bedroom</option><option value="2">2 Bedrooms</option><option value="3">3 Bedrooms</option><option value="4+">4+ Bedrooms</option></select>
                    <select name="timeline" required><option value="">How soon to buy?*</option><option value="Immediately">Immediately</option><option value="3mo">Within 3 months</option><option value="6mo">Within 6 months</option><option value="12mo">Within 12 months</option></select>
                    <div class="toggle-group"><strong style="font-size:.68rem;">Purpose:</strong><label><input type="radio" name="purpose" value="Investment" required> Investment</label><label><input type="radio" name="purpose" value="Self-Use"> Self-Use</label></div>
                    <select name="broker" id="broker-assistance" required><option value="">Assisted by a broker?*</option><option value="No">No</option><option value="Yes">Yes</option></select>
                    <input class="hidden" type="email" id="broker-email" name="brokerEmail" placeholder="Broker Email*">
                </div>
                <label class="consent-row"><input type="checkbox" id="consent" required><span>By accepting and providing my personal information, I consent to Taiseel's privacy policy and applicable data protection laws.</span></label>
                <button id="submit-btn" class="submit-btn" type="submit" disabled>Register Your Interest</button>
                <p class="success" id="form-success">One of our sales representatives will contact you shortly.</p>
            </form>
        </div>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="app-section">
            <div><h2>My Taiseel App</h2><p class="lead">Always-on service support and portfolio management.</p><ul class="bullets"><li>Access properties securely</li><li>Track valuation changes in real time</li><li>Make online payments</li><li>Schedule customer care meetings</li></ul></div>
            <div><h2>Next Steps</h2><p class="lead">This page is connected to live backend APIs for real-time unit valuations.</p><div class="app-actions"><a class="small-link" href="admin.html">üìä Admin Panel</a><a class="small-link" href="index.html">‚Üê Back to Projects</a></div></div>
        </div>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UNIT DETAIL MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="unit-detail-overlay" id="unit-detail-overlay">
    <div class="unit-detail-dialog">
        <button class="ud-close" id="ud-close">‚úï</button>

        <!-- LEFT -->
        <div class="ud-left">
            <button class="ud-back" id="ud-back">‚Üê Back to listing</button>
            <div class="ud-floorplan">
                <div class="ud-floorplan-label">‚äû Floorplan</div>
                <svg viewBox="0 0 200 310" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="8" y="8" width="184" height="294" rx="2" stroke="#334155" stroke-width="2"/>
                    <rect x="8" y="8" width="92" height="95" stroke="#334155" stroke-width="1.5"/>
                    <text x="54" y="58" text-anchor="middle" font-size="10" fill="#475569" font-family="sans-serif">BEDROOM</text>
                    <rect x="8" y="103" width="92" height="82" stroke="#334155" stroke-width="1.5"/>
                    <text x="54" y="148" text-anchor="middle" font-size="10" fill="#475569" font-family="sans-serif">BEDROOM</text>
                    <rect x="100" y="8" width="92" height="65" stroke="#334155" stroke-width="1.5"/>
                    <text x="146" y="44" text-anchor="middle" font-size="9" fill="#475569" font-family="sans-serif">BATH</text>
                    <rect x="100" y="73" width="92" height="72" stroke="#334155" stroke-width="1.5"/>
                    <text x="146" y="113" text-anchor="middle" font-size="10" fill="#475569" font-family="sans-serif">DINING</text>
                    <rect x="8" y="185" width="184" height="84" stroke="#334155" stroke-width="1.5"/>
                    <text x="100" y="232" text-anchor="middle" font-size="11" fill="#475569" font-family="sans-serif">LIVING</text>
                    <rect x="60" y="269" width="80" height="33" stroke="#334155" stroke-width="1.5"/>
                    <text x="100" y="290" text-anchor="middle" font-size="9" fill="#475569" font-family="sans-serif">ENTRY</text>
                    <path d="M8 98 Q28 98 28 78" stroke="#334155" stroke-width="1" fill="none"/>
                </svg>
            </div>
            <div class="ud-chips" id="ud-chips"></div>
            <div class="ud-about">
                <h4>About the unit</h4>
                <div class="ud-lease-head" style="margin-top:8px;">Lease terms</div>
                <div class="ud-lease-item">Lease length: Contact property manager for details</div>
                <div class="ud-building-head">More building information</div>
                <div class="ud-lease-item">No Carpet ‚Äî Premium finishes throughout</div>
                <div class="ud-lease-item">Pet-friendly (cats, dogs &amp; fish)</div>
                <div class="ud-lease-item">24/7 concierge &amp; building security</div>
            </div>
        </div>

        <!-- RIGHT -->
        <div class="ud-right">
            <div class="ud-unit-title" id="ud-unit-title">Unit ‚Äî</div>
            <div class="ud-unit-sub" id="ud-unit-sub">‚Äî</div>
            <div class="ud-fees-note">Price may not include required fees and charges. Price shown reflects the lease term provided for each unit.</div>

            <button class="ud-tour-btn">
                ‚ö° Book tour now
                <span class="ud-tour-sub">Next: Tomorrow, 11:00am</span>
            </button>
            <button class="ud-apply-btn" id="ud-apply-btn">Request to apply</button>

            <div class="ud-floor-notice">
                <span style="font-size:1rem;flex-shrink:0;margin-top:1px;">üí°</span>
                <span>There are 4+ floor plans available. With 24% more variety than properties in the area, you're sure to find a place that fits your lifestyle.</span>
            </div>

            <!-- Live unit value metrics -->
            <div style="background:#f0f5f8;border:1px solid #d9dde3;border-radius:10px;padding:14px;margin-bottom:14px;">
                <div style="font-size:.75rem;font-weight:700;color:#052f4a;margin-bottom:10px;">Unit Valuation</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                    <div style="font-size:.7rem;color:#64748b;">Zestimate¬Æ<br><strong id="ud-zestimate" style="font-size:1rem;color:#052f4a;">‚Äî</strong></div>
                    <div style="font-size:.7rem;color:#64748b;">Sales Range<br><strong id="ud-sales-range" style="font-size:.85rem;color:#052f4a;">‚Äî</strong></div>
                    <div style="font-size:.7rem;color:#64748b;">Price / sqft<br><strong id="ud-price-sqft" style="font-size:1rem;color:#052f4a;">‚Äî</strong></div>
                    <div style="font-size:.7rem;color:#64748b;">Gross Yield<br><strong id="ud-yield" style="font-size:1rem;color:#0f766e;">‚Äî</strong></div>
                </div>
            </div>

            <div class="ud-cost-section">
                <div class="ud-cost-title">Monthly Cost Calculator</div>
                <div class="ud-cost-group">
                    <div class="ud-cost-group-head">‚ñæ Monthly rent, fees &amp; charges</div>
                    <div class="ud-cost-section-label">Required</div>
                    <div class="ud-cost-row"><span>Monthly base rent</span><span id="ud-base-rent">‚Äî</span></div>
                    <div class="ud-cost-row"><span>Service charge (est.)</span><span id="ud-service-charge">‚Äî</span></div>
                    <div class="ud-cost-section-label">Optional</div>
                    <div class="ud-cost-row">
                        <span><label style="display:flex;align-items:center;gap:5px;cursor:pointer;"><input type="checkbox" id="ud-cat-chk" style="min-height:auto;width:auto;"> Cat rent ($25)</label></span>
                        <span id="ud-cat-val">$0</span>
                    </div>
                    <div class="ud-cost-row">
                        <span><label style="display:flex;align-items:center;gap:5px;cursor:pointer;"><input type="checkbox" id="ud-dog-chk" style="min-height:auto;width:auto;"> Dog rent ($25)</label></span>
                        <span id="ud-dog-val">$0</span>
                    </div>
                    <div class="ud-cost-row total-row-ud"><span>Estimated monthly total</span><span id="ud-monthly-total">‚Äî</span></div>
                </div>
                <div class="ud-cost-group">
                    <div class="ud-cost-group-head">‚ñæ One-time fees &amp; charges</div>
                    <div class="ud-cost-section-label">Required</div>
                    <div class="ud-cost-row"><span>Administration fee</span><span>$0</span></div>
                    <div class="ud-cost-row"><span>Application fee</span><span>$75</span></div>
                    <div class="ud-cost-row"><span>Security deposit</span><span id="ud-deposit">‚Äî</span></div>
                    <div class="ud-cost-section-label">Optional</div>
                    <div class="ud-cost-row"><span><label style="display:flex;align-items:center;gap:5px;cursor:pointer;"><input type="checkbox" style="min-height:auto;width:auto;"> Cat fee ($300/cat)</label></span><span>$0</span></div>
                    <div class="ud-cost-row"><span><label style="display:flex;align-items:center;gap:5px;cursor:pointer;"><input type="checkbox" style="min-height:auto;width:auto;"> Dog fee ($300/dog)</label></span><span>$0</span></div>
                </div>
                <div class="ud-estimated-total"><span>Estimated total (one-time)</span><span id="ud-one-time-total">$225 ‚Äì $425</span></div>
            </div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REQUEST TO APPLY POPUP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="apply-overlay" id="apply-overlay">
    <div class="apply-dialog">
        <button class="apply-close" id="apply-close">‚úï</button>
        <div class="apply-title" id="apply-title">Request to apply</div>

        <div id="apply-form-wrap">
            <div class="apply-field">
                <label>First &amp; last name *</label>
                <input type="text" id="apply-name" placeholder="Your full name">
            </div>
            <div class="apply-row">
                <div class="apply-field">
                    <label>Email *</label>
                    <input type="email" id="apply-email" placeholder="your@email.com">
                </div>
                <div class="apply-field">
                    <label>Phone *</label>
                    <input type="tel" id="apply-phone" placeholder="+971 XX XXX XXXX">
                </div>
            </div>
            <div class="apply-field">
                <label>Message</label>
                <textarea id="apply-message" rows="3"></textarea>
            </div>
            <div class="apply-consent">
                By clicking "Send request", you consent to Taiseel, the rental managers for the properties you choose to contact, and their respective service providers calling, texting, or sending messages to the phone number you provide. You also agree to our <a href="#" style="color:#1558d6;">Terms of Use</a> and <a href="#" style="color:#1558d6;">Privacy Policy</a>.
            </div>
            <button class="apply-send-btn" id="apply-send">Send request</button>
        </div>

        <div class="apply-success" id="apply-success">
            <span class="apply-checkmark">‚úÖ</span>
            <div class="apply-success-msg">Your request has been sent!<br><span style="font-weight:400;font-size:.85rem;color:#334155;">A representative will contact you shortly.</span></div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     AMENITIES JS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
const AMENITIES = ['Padel Courts','Outdoor Co-Working','Outdoor Dining','Fitness Zone','Infinity Pool','Beach Volleyball','Event Lawn','Kids Play Area','Gym & Studio','Concierge Lounge','Rooftop Garden','Cinema Corner'];
const ICONS = ['https://api.iconify.design/arcticons:home.svg','https://api.iconify.design/arcticons:calendar.svg','https://api.iconify.design/arcticons:camera.svg','https://api.iconify.design/arcticons:compass.svg','https://api.iconify.design/arcticons:music.svg','https://api.iconify.design/arcticons:mail.svg','https://api.iconify.design/arcticons:phone.svg','https://api.iconify.design/arcticons:location.svg','https://api.iconify.design/arcticons:weather.svg','https://api.iconify.design/arcticons:shop.svg','https://api.iconify.design/arcticons:health.svg','https://api.iconify.design/arcticons:settings.svg'];
const APAGE = 6;
const agrid = document.getElementById('amenities-grid');
const adots = document.getElementById('amenity-dots');
const apages = [];
for (let i = 0; i < AMENITIES.length; i += APAGE) apages.push(AMENITIES.slice(i, i + APAGE));
function renderAP(idx) {
    agrid.innerHTML = '';
    (apages[idx] || []).forEach((n, i) => {
        const c = document.createElement('div'); c.className = 'amenity';
        const ic = document.createElement('img'); ic.className = 'amenity-icon'; ic.src = ICONS[(idx*APAGE+i)%ICONS.length]; ic.alt = '';
        const lb = document.createElement('span'); lb.textContent = n;
        c.append(ic, lb); agrid.appendChild(c);
    });
    [...adots.children].forEach((d, i) => d.classList.toggle('active', i === idx));
}
apages.forEach((_, i) => {
    const d = document.createElement('button'); d.type = 'button'; d.className = 'bullet' + (i === 0 ? ' active' : '');
    d.addEventListener('click', () => renderAP(i)); adots.appendChild(d);
});
if (apages.length) renderAP(0);
</script>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     GALLERY JS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
(function initGallery(){
    const imgs=proj.images;const track=document.getElementById('gallery-track');const dotsEl=document.getElementById('gallery-dots');const counter=document.getElementById('gallery-counter');const prevBtn=document.getElementById('gallery-prev');const nextBtn=document.getElementById('gallery-next');
    let current=0,autoTimer;
    function buildSlides(){track.innerHTML='';imgs.forEach((img,i)=>{const slide=document.createElement('div');slide.className='gallery-slide';const main=document.createElement('div');main.className='gallery-panel';const mi=document.createElement('img');mi.src=imgs[i];mi.alt=`Visual ${i+1}`;mi.loading='lazy';main.appendChild(mi);const sec=document.createElement('div');sec.className='gallery-panel';const si=document.createElement('img');si.src=imgs[(i+1)%imgs.length];si.alt='';si.loading='lazy';sec.appendChild(si);const peek=document.createElement('div');peek.className='gallery-peek';const pi=document.createElement('img');pi.src=imgs[(i+2)%imgs.length];pi.alt='';pi.loading='lazy';peek.appendChild(pi);slide.append(main,sec,peek);track.appendChild(slide);});}
    function buildDots(){dotsEl.innerHTML='';imgs.forEach((_,i)=>{const dot=document.createElement('button');dot.type='button';dot.className='gallery-dot'+(i===0?' active':'');dot.setAttribute('aria-label',`Go to image ${i+1}`);dot.addEventListener('click',()=>goTo(i));dotsEl.appendChild(dot);});}
    function updateUI(){track.style.transform=`translateX(-${current*100}%)`;[...dotsEl.children].forEach((d,i)=>d.classList.toggle('active',i===current));const pad=n=>String(n).padStart(2,'0');counter.textContent=`${pad(current+1)} / ${pad(imgs.length)}`;prevBtn.disabled=current===0;nextBtn.disabled=current===imgs.length-1;}
    function goTo(idx){current=Math.max(0,Math.min(imgs.length-1,idx));updateUI();resetAuto();}
    function resetAuto(){clearInterval(autoTimer);autoTimer=setInterval(()=>{current=(current+1)%imgs.length;updateUI();},5000);}
    prevBtn.addEventListener('click',()=>goTo(current-1));nextBtn.addEventListener('click',()=>goTo(current+1));
    let dragStartX=0,isDragging=false;
    track.addEventListener('mousedown',e=>{isDragging=true;dragStartX=e.clientX;track.classList.add('dragging');});
    window.addEventListener('mouseup',e=>{if(!isDragging)return;isDragging=false;track.classList.remove('dragging');const diff=e.clientX-dragStartX;if(Math.abs(diff)>60)goTo(diff<0?current+1:current-1);});
    track.addEventListener('touchstart',e=>{dragStartX=e.touches[0].clientX;},{passive:true});
    track.addEventListener('touchend',e=>{const diff=e.changedTouches[0].clientX-dragStartX;if(Math.abs(diff)>50)goTo(diff<0?current+1:current-1);},{passive:true});
    buildSlides();buildDots();updateUI();resetAuto();
})();
</script>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CORE VALUATION LOGIC
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let UNITS = [];
let VAL_HISTORY = [];
let metrics = {};
let sortCol = 'unit', sortDir = 1, filterStatus = 'all', searchQ = '';
let activeChart = 'value';
let isFirstLoad = true;

// Historical YoY growth (used when we have 2+ history points)
let calculatedYoY = 8.4;

// ‚îÄ‚îÄ‚îÄ FORMATTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fmt(n, decimals = 0) {
    if (n === undefined || n === null || isNaN(n)) return '‚Äî';
    return '$' + Math.round(n).toLocaleString('en-US');
}
function fmtM(n) {
    if (n >= 1000000) return '$' + (n / 1000000).toFixed(2) + 'M';
    if (n >= 1000) return '$' + (n / 1000).toFixed(0) + 'K';
    return fmt(n);
}
function fmtPct(n, decimals = 1) {
    return n.toFixed(decimals) + '%';
}

// ‚îÄ‚îÄ‚îÄ CALCULATION ENGINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calculateBuildingMetrics(units) {
    if (!units || units.length === 0) return {};

    const totalUnits = units.length;
    const occupiedUnits = units.filter(u => u.status === 'occupied');
    const vacantUnits = units.filter(u => u.status === 'vacant');
    const listedUnits = units.filter(u => u.status === 'listed');

    const totalValue = units.reduce((s, u) => s + Number(u.value || 0), 0);
    const perUnitAvg = totalValue / totalUnits;

    // Sales range ¬±6%
    const salesRangeLow = perUnitAvg * 0.94;
    const salesRangeHigh = perUnitAvg * 1.06;

    // Rent roll from OCCUPIED units only
    const rentRoll = occupiedUnits.reduce((s, u) => s + Number(u.rent || 0), 0);
    const avgRentPerOccupied = occupiedUnits.length > 0 ? rentRoll / occupiedUnits.length : 0;

    const occupancyRate = (occupiedUnits.length / totalUnits) * 100;

    // Gross yield = (annual rent / total value) √ó 100
    const grossYield = totalValue > 0 ? ((rentRoll * 12) / totalValue) * 100 : 0;

    // Total sqft
    const totalSqft = units.reduce((s, u) => s + Number(u.sqft || 0), 0);
    const pricePerSqft = totalSqft > 0 ? totalValue / totalSqft : 0;

    // Appreciation from history
    const appreciation = calculatedYoY;
    const totalReturn = grossYield + appreciation;

    return {
        totalUnits, totalValue, perUnitAvg,
        salesRangeLow, salesRangeHigh,
        rentRoll, avgRentPerOccupied,
        occupiedCount: occupiedUnits.length,
        vacantCount: vacantUnits.length,
        listedCount: listedUnits.length,
        occupancyRate, grossYield,
        totalSqft, pricePerSqft,
        appreciation, totalReturn
    };
}

// ‚îÄ‚îÄ‚îÄ UPDATE ALL DISPLAYS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateAllDisplays(m) {
    if (!m || !m.totalValue) return;

    // ‚îÄ‚îÄ SNAPSHOT BAR
    document.getElementById('snap-building-total').textContent = fmtM(m.totalValue);
    document.getElementById('snap-total-units').textContent = m.totalUnits;
    document.getElementById('snap-occupied').textContent = m.occupiedCount;
    document.getElementById('snap-avg-unit').textContent = fmtM(m.perUnitAvg);
    document.getElementById('snap-occupancy').textContent = fmtPct(m.occupancyRate);
    document.getElementById('snap-sqft').textContent = m.totalSqft.toLocaleString();
    document.getElementById('snap-total-sqft').textContent = m.totalSqft.toLocaleString() + ' sqft';
    document.getElementById('snap-rent-roll').textContent = fmt(m.rentRoll) + '/mo';

    // ‚îÄ‚îÄ HOME VALUE CARDS
    document.getElementById('vc-building-total').textContent = fmtM(m.totalValue);
    document.getElementById('vc-building-sub').textContent = `Total estimated value ¬∑ ${m.totalUnits} units`;
    document.getElementById('vc-per-unit').textContent = fmt(m.perUnitAvg);
    document.getElementById('vc-per-unit-sub').textContent = `Average across all ${m.totalUnits} units`;

    // Sales range
    const lowStr = m.salesRangeLow >= 1000000 ? '$' + (m.salesRangeLow/1000000).toFixed(2) + 'M' : fmt(m.salesRangeLow);
    const highStr = m.salesRangeHigh >= 1000000 ? '$' + (m.salesRangeHigh/1000000).toFixed(2) + 'M' : fmt(m.salesRangeHigh);
    document.getElementById('vc-sales-range').textContent = lowStr + ' ‚Äì ' + highStr;

    // Rent roll
    document.getElementById('vc-rent-roll').innerHTML = fmt(m.rentRoll) + '<span style="font-size:.85rem;font-weight:600;">/mo</span>';
    document.getElementById('vc-rent-roll-sub').textContent = `${m.occupiedCount} occupied ¬∑ ${fmt(m.avgRentPerOccupied)} avg/unit`;

    // KPIs
    document.getElementById('vc-gross-yield').textContent = fmtPct(m.grossYield);
    document.getElementById('vc-occupancy-rate').textContent = fmtPct(m.occupancyRate);
    document.getElementById('vc-price-sqft').textContent = fmt(m.pricePerSqft);
    document.getElementById('vc-total-return').textContent = '~' + fmtPct(m.totalReturn);

    // YoY badge
    const yoyBadge = document.getElementById('vc-yoy-badge');
    const sign = m.appreciation >= 0 ? '‚Üë +' : '‚Üì ';
    yoyBadge.textContent = sign + fmtPct(m.appreciation) + ' YoY';
    yoyBadge.className = 'yoy-badge' + (m.appreciation < 0 ? ' negative' : '');

    // ‚îÄ‚îÄ SIDE CTA
    document.getElementById('side-building-total').textContent = fmtM(m.totalValue);
    document.getElementById('side-per-unit-sub').textContent = 'Per unit avg: ' + fmt(m.perUnitAvg);
    document.getElementById('side-rent-detail').textContent = `${m.occupiedCount} units ¬∑ ${fmt(m.avgRentPerOccupied)} avg`;
    document.getElementById('side-rent-total').textContent = fmt(m.rentRoll);
    document.getElementById('side-gross-yield').textContent = fmtPct(m.grossYield);
    document.getElementById('side-appreciation').textContent = (m.appreciation >= 0 ? '+' : '') + fmtPct(m.appreciation) + ' YoY';
    document.getElementById('side-total-return').textContent = '~' + fmtPct(m.totalReturn) + ' / yr';
    document.getElementById('side-occupancy').textContent = fmtPct(m.occupancyRate) + ' (' + m.occupiedCount + '/' + m.totalUnits + ')';
    document.getElementById('side-price-sqft').textContent = fmt(m.pricePerSqft);

    // ‚îÄ‚îÄ COST CALCULATOR (auto-update sell price to building Zestimate if user hasn't interacted)
    if (isFirstLoad) {
        const sellRange = document.getElementById('sell-price-range');
        // Dynamically set range min/max around current value
        const minVal = Math.floor(m.totalValue * 0.5 / 10000) * 10000;
        const maxVal = Math.ceil(m.totalValue * 1.7 / 10000) * 10000;
        sellRange.min = minVal;
        sellRange.max = maxVal;
        sellRange.value = m.totalValue;
        document.getElementById('mortgage-range').max = Math.ceil(m.totalValue * 0.85 / 10000) * 10000;
        recalcCostCalc(m.totalValue);
    }

    // ‚îÄ‚îÄ OWNER OPTIONS DYNAMIC
    document.getElementById('owner-rent-zest').textContent = fmt(m.rentRoll) + '/mo';
    document.getElementById('owner-gross-yield').textContent = fmtPct(m.grossYield);

    // ‚îÄ‚îÄ HOME DETAILS
    document.getElementById('det-total-sqft').textContent = m.totalSqft.toLocaleString() + ' sqft';
    document.getElementById('det-price-sqft').textContent = fmt(m.pricePerSqft) + ' / sqft';
    document.getElementById('det-total-units').textContent = m.totalUnits + ' units';
    document.getElementById('det-occupied').textContent = m.occupiedCount + ' / ' + m.totalUnits;
    document.getElementById('det-occupancy-pct').textContent = fmtPct(m.occupancyRate) + ' occupancy';

    // Bedroom count from units
    const bedCount = UNITS.reduce((s, u) => {
        const map = { 'Studio': 0, '1 Bed': 1, '2 Bed': 2, '3 Bed': 3, 'Penthouse': 3 };
        return s + (map[u.type] || 0);
    }, 0);
    document.getElementById('det-bedrooms').textContent = bedCount + ' total bedrooms';

    // ‚îÄ‚îÄ UNIT BREAKDOWN STRIP
    document.getElementById('occ-occupied-count').textContent = m.occupiedCount;
    document.getElementById('occ-vacant-count').textContent = m.vacantCount;
    document.getElementById('occ-listed-count').textContent = m.listedCount;
    document.getElementById('occ-bar').style.width = fmtPct(m.occupancyRate);
    document.getElementById('occ-pct-label').textContent = fmtPct(m.occupancyRate) + ' occupied';

    // Footer totals
    document.getElementById('tfoot-summary').textContent = `Totals / Avg ‚Äî ${m.totalUnits} units`;
    document.getElementById('tfoot-sqft').textContent = m.totalSqft.toLocaleString() + ' sqft';
    document.getElementById('tfoot-value').textContent = fmtM(m.totalValue);
    document.getElementById('tfoot-rent').textContent = fmt(m.rentRoll) + ' /mo';
    document.getElementById('tfoot-yield').textContent = fmtPct(m.grossYield);

    // Update filter button counts
    document.querySelectorAll('.unit-filter-btn').forEach(btn => {
        const f = btn.dataset.filter;
        let count;
        if (f === 'all') count = UNITS.length;
        else if (f === 'occupied') count = m.occupiedCount;
        else if (f === 'vacant') count = m.vacantCount;
        else if (f === 'listed') count = m.listedCount;
        btn.textContent = (f === 'all' ? 'All' : f.charAt(0).toUpperCase() + f.slice(1)) + ` (${count})`;
    });
}

// ‚îÄ‚îÄ‚îÄ COST CALCULATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function recalcCostCalc(overrideSell) {
    const sell = overrideSell !== undefined ? overrideSell : Number(document.getElementById('sell-price-range').value);
    const mort = Number(document.getElementById('mortgage-range').value);
    const prep = 120000; // fixed building prep
    const comm = sell * 0.06;
    const concessions = sell * 0.01;
    const closingFees = sell * 0.006;
    const taxes = sell * 0.005;
    const totalClosing = comm + concessions + closingFees + taxes;
    const totalCosts = prep + totalClosing;
    const net = sell - mort - totalCosts;

    document.getElementById('sell-price-display').textContent = fmtM(sell);
    document.getElementById('mortgage-display').textContent = fmtM(mort);
    document.getElementById('commission-display').textContent = fmt(comm);
    document.getElementById('concessions-display').textContent = fmt(concessions);
    document.getElementById('closing-fees-display').textContent = fmt(closingFees);
    document.getElementById('taxes-display').textContent = fmt(taxes);
    document.getElementById('closing-display').textContent = fmt(totalClosing);
    document.getElementById('total-costs-display').textContent = fmt(totalCosts);

    const netEl = document.getElementById('net-proceeds');
    netEl.textContent = fmt(net);
    netEl.className = 'calc-net-amt' + (net < 0 ? ' negative' : '');

    if (overrideSell !== undefined) {
        document.getElementById('sell-price-display').textContent = fmtM(sell);
    }
}

// Listen to sliders ‚Äî mark as user-interacted
document.getElementById('sell-price-range').addEventListener('input', () => {
    isFirstLoad = false;
    recalcCostCalc();
});
document.getElementById('mortgage-range').addEventListener('input', recalcCostCalc);

// ‚îÄ‚îÄ‚îÄ CHART ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const chartColors = { value: '#052f4a', rent: '#0f766e', tax: '#c2410c' };
const chartDataSets = { value: { data: [], color: chartColors.value }, rent: { data: [], color: chartColors.rent }, tax: { data: [], color: chartColors.tax } };
let chartLabels = [];
const ctx = document.getElementById('valueChart').getContext('2d');
const chartInst = new Chart(ctx, {
    type: 'line',
    data: {
        labels: chartLabels,
        datasets: [{
            data: [],
            borderColor: chartColors.value,
            backgroundColor: 'rgba(5,47,74,0.06)',
            borderWidth: 2.5,
            pointRadius: 3,
            pointHoverRadius: 6,
            fill: true,
            tension: 0.35
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    label: c => {
                        const v = c.parsed.y;
                        if (activeChart === 'rent') return fmt(v) + '/mo';
                        return fmtM(v);
                    }
                }
            }
        },
        scales: {
            x: { grid: { display: false }, ticks: { font: { size: 10 } } },
            y: {
                grid: { color: '#f0f4f8' },
                ticks: {
                    font: { size: 10 },
                    callback: v => {
                        if (activeChart === 'rent') return '$' + (v / 1000).toFixed(0) + 'K';
                        if (v >= 1000000) return '$' + (v / 1000000).toFixed(1) + 'M';
                        return '$' + (v / 1000).toFixed(0) + 'K';
                    }
                }
            }
        }
    }
});

function applyChartState() {
    const ds = chartDataSets[activeChart];
    chartInst.data.datasets[0].data = ds.data;
    chartInst.data.datasets[0].borderColor = ds.color;
    chartInst.data.datasets[0].backgroundColor = activeChart === 'rent' ? 'rgba(15,118,110,0.06)' : activeChart === 'tax' ? 'rgba(194,65,12,0.06)' : 'rgba(5,47,74,0.06)';
    chartInst.update();
}

function populateChartAndHistory(rows) {
    if (!rows || rows.length === 0) return;

    chartLabels = rows.map(r => r.label);
    chartDataSets.value.data = rows.map(r => r.total_value);
    chartDataSets.rent.data = rows.map(r => r.rent_roll);
    chartDataSets.tax.data = rows.map(r => r.per_unit_avg);

    chartInst.data.labels = chartLabels;
    applyChartState();

    // Compute YoY trend from last two history points
    if (rows.length >= 2) {
        const prev = rows[rows.length - 2].per_unit_avg;
        const curr = rows[rows.length - 1].per_unit_avg;
        if (prev > 0) {
            calculatedYoY = ((curr - prev) / prev) * 100;
        }
        // Also update chart trend badge
        const firstVal = rows[0].total_value;
        const lastVal = rows[rows.length - 1].total_value;
        const years = parseInt(rows[rows.length - 1].label) - parseInt(rows[0].label);
        const totalGrowth = firstVal > 0 ? ((lastVal - firstVal) / firstVal * 100).toFixed(0) : 0;
        document.getElementById('trend-label').textContent = `+${totalGrowth}% portfolio growth over ${years} years`;
    }

    // X-axis labels
    const xLabels = document.getElementById('chart-x-labels');
    xLabels.innerHTML = rows.map(r => `<span>${r.label}</span>`).join('');

    // Populate price history in details panel
    renderPriceHistory(rows);
    // Populate modal
    renderHistoryModal(rows);
}

function renderPriceHistory(rows) {
    const container = document.getElementById('price-history-rows');
    const reversed = [...rows].reverse();
    container.innerHTML = '';
    reversed.forEach((row, i) => {
        const prevRow = reversed[i + 1];
        let changeHtml = '';
        if (prevRow && prevRow.total_value > 0) {
            const pct = ((row.total_value - prevRow.total_value) / prevRow.total_value * 100).toFixed(1);
            const sign = pct >= 0 ? '+' : '';
            const cls = pct >= 0 ? 'up' : 'down';
            changeHtml = `<span class="price-change ${cls}">${sign}${pct}%</span>`;
        }
        const div = document.createElement('div');
        div.className = 'h-row' + (i === 0 ? ' zest' : '');
        div.innerHTML = `<span>${row.label}</span><span>${fmtM(row.total_value)}</span><span>${fmtM(row.per_unit_avg)}</span><span>${fmt(row.rent_roll)}/mo ${changeHtml}</span>`;
        container.appendChild(div);
    });
}

function renderHistoryModal(rows) {
    const list = document.getElementById('history-modal-list');
    list.innerHTML = '';
    [...rows].reverse().forEach(row => {
        const div = document.createElement('div');
        div.className = 'hist-row';
        div.innerHTML = `<span>${row.label}</span><span>${fmtM(row.total_value)}</span><span>${fmt(row.rent_roll)}/mo</span><span>${fmtM(row.per_unit_avg)}</span>`;
        list.appendChild(div);
    });
}

document.querySelectorAll('.cs-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.cs-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        activeChart = btn.dataset.chart;
        applyChartState();
    });
});

// ‚îÄ‚îÄ‚îÄ UNIT TABLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function unitYieldPct(u) { return ((u.rent * 12) / u.value * 100); }
function unitYieldStr(u) { return unitYieldPct(u).toFixed(2) + '%'; }

function statusPill(s) {
    const map = { occupied: '‚óè Occupied', vacant: '‚óã Vacant', listed: '‚óà Listed' };
    return `<span class="ut-pill ${s}">${map[s] || s}</span>`;
}

function getFiltered() {
    return UNITS.filter(u => {
        const mF = filterStatus === 'all' || u.status === filterStatus;
        const q = searchQ.toLowerCase();
        const mS = !q || u.unit.toLowerCase().includes(q) || u.type.toLowerCase().includes(q) || String(u.floor).includes(q);
        return mF && mS;
    }).sort((a, b) => {
        let av = a[sortCol], bv = b[sortCol];
        if (sortCol === 'yield') { av = unitYieldPct(a); bv = unitYieldPct(b); }
        if (typeof av === 'string') return av.localeCompare(bv) * sortDir;
        return (av - bv) * sortDir;
    });
}

function renderUnitTable() {
    const data = getFiltered();
    const tbody = document.getElementById('unit-tbody');
    tbody.innerHTML = '';
    if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:30px;color:#94a3b8;">No units match the filter.</td></tr>';
        return;
    }
    data.forEach(u => {
        const tr = document.createElement('tr');
        const rentDisplay = u.status === 'vacant'
            ? `<span style="color:#94a3b8;font-style:italic;font-size:.72rem;">~${fmt(u.rent)} est.</span>`
            : fmt(u.rent);
        // Embed full unit data as JSON in data attribute for modal
        const unitJson = JSON.stringify(u).replace(/"/g, '&quot;');
        tr.innerHTML = `
            <td><strong>${u.unit}</strong></td>
            <td>${u.floor}</td>
            <td>${u.type}</td>
            <td>${Number(u.sqft).toLocaleString()}</td>
            <td class="ut-value-highlight">${fmt(u.value)}</td>
            <td>${rentDisplay}</td>
            <td>${unitYieldStr(u)}</td>
            <td>${statusPill(u.status)}</td>
            <td><button class="msg-btn" data-unit="${unitJson}">Details</button></td>
        `;
        tbody.appendChild(tr);
    });
}

document.querySelectorAll('.unit-table th[data-col]').forEach(th => {
    th.addEventListener('click', () => {
        document.querySelectorAll('.unit-table th').forEach(h => { h.classList.remove('ut-sorted'); const s = h.querySelector('.th-sort'); if (s) s.textContent = '‚Üï'; });
        if (sortCol === th.dataset.col) sortDir *= -1; else { sortCol = th.dataset.col; sortDir = 1; }
        th.classList.add('ut-sorted');
        th.querySelector('.th-sort').textContent = sortDir === 1 ? '‚Üë' : '‚Üì';
        renderUnitTable();
    });
});
document.querySelectorAll('.unit-filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.unit-filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        filterStatus = btn.dataset.filter;
        renderUnitTable();
    });
});
document.getElementById('unit-search').addEventListener('input', e => { searchQ = e.target.value; renderUnitTable(); });

// ‚îÄ‚îÄ‚îÄ API CALLS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function fetchUnits() {
    const response = await fetch('/api/units');
    if (!response.ok) throw new Error('Units API error ' + response.status);
    return response.json();
}

async function fetchHistory() {
    const response = await fetch('/api/valuation-history');
    if (!response.ok) throw new Error('History API error ' + response.status);
    return response.json();
}

async function refreshAll() {
    try {
        const [units, history] = await Promise.all([fetchUnits(), fetchHistory()]);

        UNITS = units;
        VAL_HISTORY = history;

        // Compute metrics from live unit data
        metrics = calculateBuildingMetrics(UNITS);

        // Compute YoY from history before updating displays
        if (history.length >= 2) {
            const prev = history[history.length - 2].per_unit_avg;
            const curr = history[history.length - 1].per_unit_avg;
            if (prev > 0) calculatedYoY = ((curr - prev) / prev) * 100;
            metrics.appreciation = calculatedYoY;
            metrics.totalReturn = metrics.grossYield + calculatedYoY;
        }

        updateAllDisplays(metrics);
        populateChartAndHistory(history);
        renderUnitTable();

        // Recalc cost calc with live value if first load
        if (isFirstLoad) {
            recalcCostCalc(metrics.totalValue);
        }

        isFirstLoad = false;

        // Live indicator
        document.getElementById('live-indicator').textContent = 'Live data ¬∑ last updated ' + new Date().toLocaleTimeString();

    } catch (err) {
        console.error('Data refresh failed:', err);
        // Show fallback data
        if (isFirstLoad) {
            document.getElementById('live-indicator').textContent = '‚ö† Could not connect to API ‚Äî showing placeholder data';
            loadFallbackData();
        }
    }
}

// Fallback if API unavailable (demo mode with static data)
function loadFallbackData() {
    const fallbackUnits = [
        {id:1,unit:'101',floor:1,type:'Studio',sqft:520,status:'occupied',value:540000,rent:1850,last_sold_at:'2023-07-03'},
        {id:2,unit:'102',floor:1,type:'1 Bed',sqft:850,status:'occupied',value:850000,rent:2800,last_sold_at:'2023-06-15'},
        {id:3,unit:'103',floor:1,type:'2 Bed',sqft:1180,status:'occupied',value:1180000,rent:3800,last_sold_at:'2024-01-22'},
        {id:4,unit:'104',floor:1,type:'2 Bed',sqft:1200,status:'vacant',value:1200000,rent:3900,last_sold_at:'2024-05-30'},
        {id:5,unit:'201',floor:2,type:'Studio',sqft:530,status:'occupied',value:555000,rent:1900,last_sold_at:'2023-03-14'},
        {id:6,unit:'202',floor:2,type:'1 Bed',sqft:870,status:'occupied',value:890000,rent:2950,last_sold_at:'2023-11-21'},
        {id:7,unit:'203',floor:2,type:'2 Bed',sqft:1200,status:'listed',value:1220000,rent:3950,last_sold_at:'2025-01-12'},
        {id:8,unit:'204',floor:2,type:'3 Bed',sqft:1650,status:'occupied',value:1680000,rent:5200,last_sold_at:'2024-09-05'},
        {id:9,unit:'301',floor:3,type:'1 Bed',sqft:870,status:'occupied',value:910000,rent:3000,last_sold_at:'2024-02-18'},
        {id:10,unit:'302',floor:3,type:'2 Bed',sqft:1200,status:'occupied',value:1240000,rent:4000,last_sold_at:'2023-08-09'},
        {id:11,unit:'303',floor:3,type:'3 Bed',sqft:1670,status:'occupied',value:1720000,rent:5350,last_sold_at:'2024-10-10'},
        {id:12,unit:'304',floor:3,type:'2 Bed',sqft:1190,status:'occupied',value:1230000,rent:3980,last_sold_at:'2023-12-01'},
        {id:13,unit:'401',floor:4,type:'1 Bed',sqft:875,status:'occupied',value:930000,rent:3100,last_sold_at:'2025-02-03'},
        {id:14,unit:'402',floor:4,type:'2 Bed',sqft:1210,status:'occupied',value:1260000,rent:4100,last_sold_at:'2024-11-18'},
        {id:15,unit:'403',floor:4,type:'3 Bed',sqft:1680,status:'vacant',value:1750000,rent:5500,last_sold_at:'2025-01-25'},
        {id:16,unit:'404',floor:4,type:'2 Bed',sqft:1195,status:'occupied',value:1250000,rent:4050,last_sold_at:'2024-03-28'},
        {id:17,unit:'501',floor:5,type:'2 Bed',sqft:1400,status:'occupied',value:1480000,rent:4600,last_sold_at:'2025-02-02'},
        {id:18,unit:'502',floor:5,type:'Penthouse',sqft:2200,status:'occupied',value:2400000,rent:7200,last_sold_at:'2024-12-15'},
        {id:19,unit:'601',floor:6,type:'Penthouse',sqft:2400,status:'occupied',value:2700000,rent:7800,last_sold_at:'2025-01-17'},
        {id:20,unit:'602',floor:6,type:'Penthouse',sqft:2350,status:'occupied',value:2640000,rent:7580,last_sold_at:'2024-08-29'}
    ];
    const fallbackHistory = [
        {label:'2019',total_value:11900000,rent_roll:41000,per_unit_avg:598000},
        {label:'2020',total_value:12300000,rent_roll:39800,per_unit_avg:614000},
        {label:'2021',total_value:15800000,rent_roll:46000,per_unit_avg:790000},
        {label:'2022',total_value:18400000,rent_roll:53500,per_unit_avg:920000},
        {label:'2023',total_value:20100000,rent_roll:57800,per_unit_avg:1005000},
        {label:'2024',total_value:22200000,rent_roll:62100,per_unit_avg:1110000},
        {label:'2025',total_value:24120000,rent_roll:67320,per_unit_avg:1206000}
    ];

    UNITS = fallbackUnits;
    VAL_HISTORY = fallbackHistory;
    metrics = calculateBuildingMetrics(UNITS);
    calculatedYoY = 8.4;
    metrics.appreciation = calculatedYoY;
    metrics.totalReturn = metrics.grossYield + calculatedYoY;

    updateAllDisplays(metrics);
    populateChartAndHistory(fallbackHistory);
    renderUnitTable();
    recalcCostCalc(metrics.totalValue);
    isFirstLoad = false;
}

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.val-tab').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.val-tab').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.val-panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('panel-' + btn.dataset.tab).classList.add('active');
    });
});

// ‚îÄ‚îÄ‚îÄ ACCORDIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.acc-trigger').forEach(btn => {
    btn.addEventListener('click', () => btn.closest('.acc-item').classList.toggle('open'));
});

// ‚îÄ‚îÄ‚îÄ MAP CONTROLS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.map-ctrl-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.map-ctrl-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    });
});

// ‚îÄ‚îÄ‚îÄ HISTORY MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('open-history').addEventListener('click', () => document.getElementById('history-modal').classList.add('open'));
document.getElementById('close-history').addEventListener('click', () => document.getElementById('history-modal').classList.remove('open'));
document.getElementById('history-modal').addEventListener('click', e => { if (e.target === e.currentTarget) e.currentTarget.classList.remove('open'); });

// ‚îÄ‚îÄ‚îÄ FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const form = document.getElementById('interest-form');
const bsel = document.getElementById('broker-assistance');
const bemail = document.getElementById('broker-email');
const sbtn = document.getElementById('submit-btn');
const consent = document.getElementById('consent');

function validateForm() { sbtn.disabled = !(form.checkValidity() && consent.checked); }
bsel.addEventListener('change', () => {
    const y = bsel.value === 'Yes';
    bemail.classList.toggle('hidden', !y);
    bemail.required = y;
    if (!y) bemail.value = '';
    validateForm();
});
form.addEventListener('input', validateForm);
consent.addEventListener('change', validateForm);
form.addEventListener('submit', async e => {
    e.preventDefault();
    if (!(form.checkValidity() && consent.checked)) return;

    const data = {};
    new FormData(form).forEach((v, k) => { data[k] = v; });

    try {
        const res = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        if (res.ok) {
            document.getElementById('form-success').style.display = 'block';
            form.reset();
            bemail.classList.add('hidden');
            sbtn.disabled = true;
        }
    } catch (err) {
        console.error('Form submission error:', err);
    }
});

// ‚îÄ‚îÄ‚îÄ UNIT DETAIL MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const unitDetailOverlay = document.getElementById('unit-detail-overlay');
const applyOverlay = document.getElementById('apply-overlay');
let currentModalUnit = null;

function bedLabel(type) {
    const m = { 'Studio': 'Studio, 1 ba', '1 Bed': '1 bd, 1 ba', '2 Bed': '2 bd, 2 ba', '3 Bed': '3 bd, 2 ba', 'Penthouse': '3 bd, 3 ba' };
    return m[type] || type;
}

function openUnitDetail(u) {
    currentModalUnit = u;

    // Header
    document.getElementById('ud-unit-title').textContent = `Unit ${u.unit}`;
    const rentLabel = u.status === 'occupied' ? fmt(u.rent) + '/mo' : `~${fmt(u.rent)}/mo (market est.)`;
    document.getElementById('ud-unit-sub').innerHTML = `${bedLabel(u.type)} &nbsp;¬∑&nbsp; Floor ${u.floor} &nbsp;¬∑&nbsp; <strong>${rentLabel}</strong> <span style="font-size:.73rem;color:#64748b;">Fees may apply</span>`;

    // Valuation metrics (live from unit data)
    document.getElementById('ud-zestimate').textContent = fmt(u.value);
    const low = (u.value * 0.94); const high = (u.value * 1.06);
    document.getElementById('ud-sales-range').textContent =
        (low >= 1000000 ? '$' + (low/1000000).toFixed(2) + 'M' : fmt(low)) + ' ‚Äì ' +
        (high >= 1000000 ? '$' + (high/1000000).toFixed(2) + 'M' : fmt(high));
    document.getElementById('ud-price-sqft').textContent = u.sqft > 0 ? '$' + Math.round(u.value / u.sqft).toLocaleString() : '‚Äî';
    document.getElementById('ud-yield').textContent = u.value > 0 ? ((u.rent * 12 / u.value) * 100).toFixed(2) + '%' : '‚Äî';

    // Cost calculator (live rent)
    const serviceCharge = Math.round(u.rent * 0.08); // 8% service charge
    document.getElementById('ud-base-rent').textContent = fmt(u.rent);
    document.getElementById('ud-service-charge').textContent = fmt(serviceCharge);
    document.getElementById('ud-monthly-total').textContent = fmt(u.rent + serviceCharge);
    document.getElementById('ud-deposit').textContent = fmt(u.rent * 1.5) + ' ‚Äì ' + fmt(u.rent * 2);
    document.getElementById('ud-one-time-total').textContent = '$75 + ' + fmt(u.rent * 1.5) + ' dep.';

    // Pet checkboxes recalc
    function recalcUDTotal() {
        const catExtra = document.getElementById('ud-cat-chk').checked ? 25 : 0;
        const dogExtra = document.getElementById('ud-dog-chk').checked ? 25 : 0;
        document.getElementById('ud-cat-val').textContent = '$' + catExtra;
        document.getElementById('ud-dog-val').textContent = '$' + dogExtra;
        document.getElementById('ud-monthly-total').textContent = fmt(u.rent + serviceCharge + catExtra + dogExtra);
    }
    document.getElementById('ud-cat-chk').checked = false;
    document.getElementById('ud-dog-chk').checked = false;
    document.getElementById('ud-cat-chk').onchange = recalcUDTotal;
    document.getElementById('ud-dog-chk').onchange = recalcUDTotal;

    // Availability chip
    const availMap = { occupied: 'Contact manager', vacant: 'Available Now', listed: 'Mar 27, 2026' };
    const statusColor = { occupied: '#047857', vacant: '#b45309', listed: '#1558d6' };
    document.getElementById('ud-chips').innerHTML = `
        <div class="ud-chip">üìÖ <div><div style="font-size:.64rem;color:#94a3b8;margin-bottom:2px;">Available</div><strong style="color:${statusColor[u.status]}">${availMap[u.status] || 'Contact'}</strong></div></div>
        <div class="ud-chip">üìê <div><div style="font-size:.64rem;color:#94a3b8;margin-bottom:2px;">Size</div><strong>${Number(u.sqft).toLocaleString()} sqft</strong></div></div>
        <div class="ud-chip">üè¢ <div><div style="font-size:.64rem;color:#94a3b8;margin-bottom:2px;">Floor</div><strong>Floor ${u.floor}</strong></div></div>
        <div class="ud-chip">üó∫Ô∏è <div><div style="font-size:.64rem;color:#94a3b8;margin-bottom:2px;">Plan</div><strong>Plan ${u.type.replace(' ','')}-${u.floor}</strong></div></div>
        <div class="ud-chip" style="grid-column:span 2;">üí∞ <div><div style="font-size:.64rem;color:#94a3b8;margin-bottom:2px;">Estimated Value</div><strong style="color:#052f4a;">${fmt(u.value)}</strong></div></div>
    `;

    // Reset apply form
    document.getElementById('apply-form-wrap').style.display = 'block';
    document.getElementById('apply-success').style.display = 'none';
    document.getElementById('apply-name').value = '';
    document.getElementById('apply-email').value = '';
    document.getElementById('apply-phone').value = '';
    document.getElementById('apply-message').value = `I'm interested in Unit ${u.unit} (Floor ${u.floor}, ${u.type}) and would like to move forward. Can you send me an application?`;

    unitDetailOverlay.classList.add('open');
    document.body.style.overflow = 'hidden';
}

function closeUnitDetail() {
    unitDetailOverlay.classList.remove('open');
    document.body.style.overflow = '';
    closeApplyPopup();
}

function openApplyPopup() {
    if (currentModalUnit) {
        document.getElementById('apply-title').textContent = `Apply for Unit ${currentModalUnit.unit}`;
    }
    applyOverlay.classList.add('open');
}

function closeApplyPopup() {
    applyOverlay.classList.remove('open');
}

// Modal button events
document.getElementById('ud-close').addEventListener('click', closeUnitDetail);
document.getElementById('ud-back').addEventListener('click', closeUnitDetail);
unitDetailOverlay.addEventListener('click', e => { if (e.target === unitDetailOverlay) closeUnitDetail(); });

document.getElementById('ud-apply-btn').addEventListener('click', openApplyPopup);
document.getElementById('apply-close').addEventListener('click', closeApplyPopup);
applyOverlay.addEventListener('click', e => { if (e.target === applyOverlay) closeApplyPopup(); });

// Send request
document.getElementById('apply-send').addEventListener('click', () => {
    const name = document.getElementById('apply-name').value.trim();
    const email = document.getElementById('apply-email').value.trim();
    const phone = document.getElementById('apply-phone').value.trim();
    if (!name) { document.getElementById('apply-name').focus(); return; }
    if (!email) { document.getElementById('apply-email').focus(); return; }
    if (!phone) { document.getElementById('apply-phone').focus(); return; }
    document.getElementById('apply-form-wrap').style.display = 'none';
    document.getElementById('apply-success').style.display = 'block';
    setTimeout(() => closeApplyPopup(), 2800);
});

// Delegate click on unit table ‚Äî parse full unit JSON from data attribute
document.getElementById('unit-tbody').addEventListener('click', e => {
    const btn = e.target.closest('.msg-btn');
    if (!btn) return;
    try {
        const u = JSON.parse(btn.getAttribute('data-unit').replace(/&quot;/g, '"'));
        openUnitDetail(u);
    } catch (err) {
        console.error('Failed to parse unit data:', err);
    }
});

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
refreshAll();
setInterval(refreshAll, 15000);
</script>

</body>
</html>
